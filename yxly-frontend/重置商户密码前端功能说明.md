# 前端重置商户密码功能说明

## 功能概述

在超级管理员的商户审核管理页面，为已通过审核的商户添加"重置密码"功能，帮助忘记密码的商户恢复账号访问。

## 修改的文件

### 1. `/src/api/modules/superAdmin.js`

添加了重置商户密码的 API 接口调用。

```javascript
/**
 * 重置商户密码
 * @param {object} data - 重置密码数据
 * @param {number} data.merchantId - 商户ID
 * @param {string} data.newPassword - 新密码
 */
export const resetMerchantPassword = (data) => {
  return request({
    url: '/api/v1/super-admin/merchants/reset-password',
    method: 'post',
    data
  })
}
```

### 2. `/src/pages/super-admin/MerchantAudit.vue`

#### 修改内容：

1. **添加"重置密码"按钮**
   - 只对已通过审核的商户显示（`auditStatus === 1`）
   - 按钮类型：`warning`（黄色警告色）
   - 位置：在操作列，详情按钮后面

2. **添加重置密码对话框**
   - 显示商户信息：ID、名称、真实姓名、用户名
   - 新密码输入框（默认值：`merchant123`）
   - 密码要求提示：6-20位，包含字母和数字
   - 警告提示：建议及时通知商户并让其修改密码

3. **添加重置密码逻辑**
   - 密码格式验证
   - 调用后端 API
   - 成功后显示新密码弹窗供管理员复制

## 功能特点

### UI 特点

1. **只对已审核商户显示**
   ```vue
   <el-button
     v-if="row.auditStatus === 1"
     type="warning"
     size="small"
     @click="handleResetPassword(row)"
   >
     重置密码
   </el-button>
   ```

2. **默认密码**
   - 建议密码：`merchant123`
   - 可以自定义修改

3. **安全提示**
   - 对话框中显示警告：及时通知商户
   - 成功后弹窗显示新密码供复制

### 密码验证

```javascript
// 前端验证密码格式
const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{6,20}$/
if (!passwordRegex.test(resetPasswordForm.value.newPassword)) {
  ElMessage.warning('密码格式不正确，需要6-20位且包含字母和数字')
  return
}
```

**要求：**
- 长度：6-20 位
- 必须包含字母
- 必须包含数字
- 可选特殊字符：`@$!%*#?&`

### 用户体验

#### 1. 点击"重置密码"按钮
弹出对话框，显示商户信息和密码输入框。

#### 2. 输入新密码
- 默认填充 `merchant123`
- 可以修改为其他密码
- 显示密码要求提示

#### 3. 点击"确认重置"
- 前端验证密码格式
- 调用后端 API
- 显示 loading 状态

#### 4. 重置成功
弹出提示框显示新密码：
```
新密码：merchant123

请及时通知商户并建议其登录后立即修改密码。

[我已复制密码]
```

#### 5. 重置失败
显示错误提示信息。

## 代码结构

### 状态定义

```javascript
// 对话框显示状态
const resetPasswordDialogVisible = ref(false)

// 重置密码表单
const resetPasswordForm = ref({
  merchantId: null,
  newPassword: 'merchant123'
})
```

### 处理函数

```javascript
// 处理重置密码按钮点击
const handleResetPassword = (row) => {
  currentMerchant.value = row
  resetPasswordForm.value = {
    merchantId: row.id,
    newPassword: 'merchant123'
  }
  resetPasswordDialogVisible.value = true
}

// 确认重置密码
const confirmResetPassword = async () => {
  // 1. 验证密码不为空
  if (!resetPasswordForm.value.newPassword) {
    ElMessage.warning('请输入新密码')
    return
  }

  // 2. 验证密码格式
  const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{6,20}$/
  if (!passwordRegex.test(resetPasswordForm.value.newPassword)) {
    ElMessage.warning('密码格式不正确，需要6-20位且包含字母和数字')
    return
  }

  // 3. 调用 API
  submitLoading.value = true
  try {
    await resetMerchantPassword(resetPasswordForm.value)
    ElMessage.success('密码重置成功')
    resetPasswordDialogVisible.value = false
    
    // 4. 显示新密码提示
    ElMessageBox.alert(
      `新密码：${resetPasswordForm.value.newPassword}\n\n请及时通知商户并建议其登录后立即修改密码。`,
      '重置成功',
      {
        confirmButtonText: '我已复制密码',
        type: 'success',
        dangerouslyUseHTMLString: false
      }
    )
  } catch (error) {
    console.error('重置密码失败:', error)
    ElMessage.error(error.message || '重置密码失败')
  } finally {
    submitLoading.value = false
  }
}
```

## 测试步骤

### 1. 访问商户审核管理页面
```
http://localhost:3000/#/super-admin/merchant-audit
```

### 2. 筛选已通过的商户
- 在筛选条件中选择"已通过"
- 点击"查询"

### 3. 点击"重置密码"按钮
- 查看已通过审核的商户
- 点击操作列的"重置密码"按钮

### 4. 填写新密码
- 默认密码：`merchant123`
- 可以修改为其他密码（需符合格式要求）

### 5. 确认重置
- 点击"确认重置"按钮
- 等待操作完成

### 6. 查看结果
- 成功：弹窗显示新密码
- 失败：显示错误提示

### 7. 验证重置结果
- 用新密码登录商户账号
- 确认是否能正常登录

## 界面截图位置

### 商户列表（已通过审核的商户）
```
| 商户ID | 用户名 | 真实姓名 | 审核状态 | 操作                          |
|--------|--------|----------|----------|-------------------------------|
| 1      | XHH    | 小灰灰   | 已通过   | [详情] [重置密码]             |
| 2      | XYY    | 小羊羊   | 已通过   | [详情] [重置密码]             |
```

### 重置密码对话框
```
┌────────────────────────────────┐
│  重置商户密码                  │
├────────────────────────────────┤
│  商户ID:    1                  │
│  商户名称:  小灰灰的民宿       │
│  真实姓名:  小灰灰             │
│  用户名:    XHH                │
│  新密码:    [merchant123    ]  │
│             密码要求：6-20位， │
│             包含字母和数字     │
│                                │
│  ⚠️ 重置后请及时通知商户新密  │
│     码，建议商户登录后立即修   │
│     改                         │
│                                │
│          [取消] [确认重置]     │
└────────────────────────────────┘
```

### 成功提示弹窗
```
┌────────────────────────────────┐
│  ✓ 重置成功                    │
├────────────────────────────────┤
│  新密码：merchant123           │
│                                │
│  请及时通知商户并建议其登录后  │
│  立即修改密码。                │
│                                │
│         [我已复制密码]         │
└────────────────────────────────┘
```

## 注意事项

### 1. 权限控制
- 只有超级管理员可以访问此页面
- 后端也会验证权限

### 2. 数据安全
- 密码通过 HTTPS 传输
- 后端使用 BCrypt 加密存储
- 前端不保存密码

### 3. 操作提示
- 成功后提示管理员复制密码
- 建议及时通知商户
- 建议商户登录后修改密码

### 4. 错误处理
- 网络错误：显示"重置密码失败"
- 商户不存在：显示"商户不存在"
- 账号已禁用：显示"商户账号已被禁用"
- 密码格式错误：前端验证并提示

## 与用户自助重置密码的区别

| 功能 | 用户自助重置 | 超级管理员重置 |
|------|--------------|----------------|
| 验证方式 | 手机号 + 邮箱 | 无需验证 |
| 操作人 | 用户自己 | 超级管理员 |
| 密码设置 | 用户设置 | 管理员设置 |
| 使用场景 | 用户忘记密码 | 商户联系客服 |
| 安全级别 | 双重验证 | 管理员权限控制 |

## 扩展建议

### 1. 添加操作日志
记录管理员重置了哪个商户的密码。

### 2. 短信/邮件通知
重置成功后自动发送通知给商户。

### 3. 批量重置
允许批量重置多个商户的密码。

### 4. 密码模板选择
提供多个预设密码模板供选择。

### 5. 强制修改密码
商户首次登录时强制修改密码。

## 总结

✅ 前端功能已完成  
✅ 只对已审核商户显示重置按钮  
✅ 提供友好的操作界面和提示  
✅ 包含密码格式验证  
✅ 成功后显示新密码供复制  

前端已完全集成，配合后端 API 即可正常使用！
