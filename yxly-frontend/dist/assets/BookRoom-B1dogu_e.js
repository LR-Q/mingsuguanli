/* empty css                  *//* empty css                */import{g as ue}from"./review-Bo7FEJ-k.js";/* empty css                  *//* empty css                 *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                  *//* empty css                     *//* empty css               *//* empty css                             *//* empty css                        *//* empty css                         */import{aB as ce,aE as de,r as v,l as me,c as A,j as pe,al as ge,z as c,B as t,R as s,J as o,O as h,I as B,L as D,A as u,u as x,K as J,S as j,Q as N,a6 as O,E as ve,P as d}from"./vendor-DSBWSuTS.js";import{E as V,j as _e,Q as fe,U as ke,n as he,T as K,X as ye,v as Ie,W as be,k as we,Y as xe,Z as Ve,d as Ee,P as Le,L as Re,K as Ce,e as Be,_ as De,R as Ne,r as Oe,$ as Te,a as qe,a0 as Se}from"./elementPlus-fsp5CJhs.js";import{c as $e}from"./userRoom-DRSYUXnR.js";import{c as ze}from"./booking-Bi3Wmyaa.js";import{_ as Pe}from"./index-rlk3mQiZ.js";const Ae={class:"book-room"},Ue={class:"container"},Fe={class:"booking-header"},Me={class:"booking-content"},Ge={key:0,class:"loading-container"},Je={class:"image-placeholder"},je={key:1,class:"image-placeholder"},Ke={key:2,class:"image-controls"},Qe={class:"image-indicators"},We=["onClick"],Xe={class:"main-content"},Ye={class:"left-section"},Ze={class:"room-info-section"},He={class:"room-description"},et={class:"room-specs"},tt={class:"spec-item"},at={class:"spec-item"},st={key:0,class:"spec-item"},ot={class:"booking-form-section"},lt={key:0,class:"room-facilities-section"},nt={class:"facilities-tags"},rt={class:"room-reviews-section"},it={key:0,class:"no-reviews"},ut={key:1},ct={class:"review-header"},dt={class:"review-meta"},mt={class:"name"},pt={class:"time"},gt={class:"review-content"},vt={key:0,class:"reviews-actions"},_t={class:"right-section"},ft={class:"price-card"},kt={class:"price-details"},ht={class:"price-item"},yt={class:"price-item"},It={class:"price-item subtotal"},bt={class:"price-item total"},wt={class:"booking-actions"},xt={__name:"BookRoom",setup(Vt){const E=ce(),L=de(),T=v(),q=v(!1),S=v(!0),R=v(!1),a=v({id:null,name:"",description:"",price:0,maxGuests:1,area:0,features:[],bedSummary:""}),r=me({checkIn:L.query.checkIn||"",checkOut:L.query.checkOut||"",guests:L.query.guests||1,contactName:"",contactPhone:"",specialRequests:""}),Q={checkIn:[{required:!0,message:"请选择入住日期",trigger:"change"}],checkOut:[{required:!0,message:"请选择退房日期",trigger:"change"}],guests:[{required:!0,message:"请选择入住人数",trigger:"change"}],contactName:[{required:!0,message:"请输入联系人姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度在2-20个字符",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},$=A(()=>{if(!r.checkIn||!r.checkOut)return 0;const i=new Date(r.checkIn),n=new Date(r.checkOut)-i;return Math.ceil(n/(1e3*60*60*24))}),U=A(()=>a.value.price*$.value),F=A(()=>U.value),C=v(!1),_=v({current:1,size:5,total:0}),f=v([]),M=async(i=!1)=>{if(a.value.id)try{C.value=!0,i&&(_.value.current=1);const{data:e}=await ue(a.value.id,{current:_.value.current,size:_.value.size});_.value.total=e.total,i?f.value=e.records||[]:f.value=f.value.concat(e.records||[])}finally{C.value=!1}},W=i=>i.getTime()<Date.now()-864e5,X=i=>r.checkIn?i.getTime()<new Date(r.checkIn).getTime()+864e5:i.getTime()<Date.now()-864e5,G=()=>{E.go(-1)},Y=()=>{a.value.imageList&&a.value.imageList.length>1&&(a.value.currentImageIndex=a.value.currentImageIndex>0?a.value.currentImageIndex-1:a.value.imageList.length-1,a.value.currentImage=a.value.imageList[a.value.currentImageIndex])},Z=()=>{a.value.imageList&&a.value.imageList.length>1&&(a.value.currentImageIndex=a.value.currentImageIndex<a.value.imageList.length-1?a.value.currentImageIndex+1:0,a.value.currentImage=a.value.imageList[a.value.currentImageIndex])},H=i=>{a.value.imageList&&a.value.imageList.length>i&&(a.value.currentImageIndex=i,a.value.currentImage=a.value.imageList[i])},ee=async()=>{if(T.value)try{if(await T.value.validate(),$.value<=0){V.error("退房日期必须晚于入住日期");return}await qe.confirm(`确认预订 ${a.value.name}？
入住时间：${r.checkIn} 至 ${r.checkOut}
总费用：￥${F.value}`,"确认预订",{confirmButtonText:"确认预订",cancelButtonText:"取消",type:"info"}),q.value=!0;const i={roomId:a.value.id,checkInDate:r.checkIn,checkOutDate:r.checkOut,guestsCount:r.guests,contactName:r.contactName,contactPhone:r.contactPhone,specialRequests:r.specialRequests};await ze(i),V.success("预订成功！我们会尽快与您联系确认"),E.push("/user-center/orders")}catch(i){i!=="cancel"&&(console.error("预订失败:",i),V.error(i.message||"预订失败，请重试"))}finally{q.value=!1}};return pe(async()=>{const i=L.params.id;if(!i){V.error("房间ID不存在"),E.push("/rooms");return}try{S.value=!0,console.log("正在获取房间详情，房间ID:",i);const n=(await $e(i)).data;console.log("房间数据:",n);let k=[];if(n.facilities&&typeof n.facilities=="string")try{k=JSON.parse(n.facilities)}catch{k=[]}else Array.isArray(n.facilities)&&(k=n.facilities);let m=[],y=null;if(n.images&&typeof n.images=="string")try{m=JSON.parse(n.images),y=m.length>0?m[0]:null}catch{m=[],y=null}let I="";if(n.bedroomConfig&&typeof n.bedroomConfig=="string")try{const g=JSON.parse(n.bedroomConfig);g&&Array.isArray(g.bedrooms)&&(I=g.bedrooms.map(p=>`${p.name||""} ${p.bedType||""}×${p.bedCount||1}`.trim()).join(" · "))}catch{I=""}a.value={id:n.id,name:n.roomNumber+"号房 - "+(n.roomTypeName||"标准房"),description:n.description||"舒适温馨的房间，为您提供优质的住宿体验",price:n.currentPrice||n.price||0,maxGuests:n.maxGuests||2,area:n.area||0,features:k,imageList:m,currentImage:y,currentImageIndex:0,bedType:n.bedType,bedSummary:I},await M(!0)}catch(e){console.error("获取房间详情失败:",e),V.error("获取房间信息失败"),E.push("/rooms")}finally{S.value=!1}}),(i,e)=>{const n=_e,k=fe,m=he,y=ke,I=ge("ArrowRight"),g=Le,p=Ee,b=Ve,z=xe,te=Ce,ae=Re,P=Be,se=we,oe=De,le=Ne,ne=Oe,re=Te,ie=Se;return u(),c("div",Ae,[t("div",Ue,[t("div",Fe,[s(n,{onClick:G,icon:"ArrowLeft"},{default:o(()=>[...e[9]||(e[9]=[h("返回房间列表",-1)])]),_:1}),e[10]||(e[10]=t("h1",null,"预订房间",-1))]),t("div",Me,[S.value?(u(),c("div",Ge,[s(k,{rows:8,animated:""})])):(u(),B(ie,{key:1,class:"booking-card"},{default:o(()=>[t("div",{class:"room-image-section",onMouseenter:e[0]||(e[0]=l=>R.value=!0),onMouseleave:e[1]||(e[1]=l=>R.value=!1)},[a.value.currentImage?(u(),B(y,{key:0,src:a.value.currentImage,fit:"cover",class:"room-main-image"},{error:o(()=>[t("div",Je,[s(m,{size:"120"},{default:o(()=>[s(x(K))]),_:1}),e[11]||(e[11]=t("p",null,"房间图片",-1))])]),_:1},8,["src"])):(u(),c("div",je,[s(m,{size:"120"},{default:o(()=>[s(x(K))]),_:1}),e[12]||(e[12]=t("p",null,"房间图片",-1))])),a.value.imageList&&a.value.imageList.length>1?(u(),c("div",Ke,[J(t("div",{class:"image-nav prev-btn",onClick:Y},[s(m,null,{default:o(()=>[s(x(ye))]),_:1})],512),[[j,R.value]]),J(t("div",{class:"image-nav next-btn",onClick:Z},[s(m,null,{default:o(()=>[s(I)]),_:1})],512),[[j,R.value]]),t("div",Qe,[(u(!0),c(N,null,O(a.value.imageList,(l,w)=>(u(),c("span",{key:w,class:ve(["indicator",{active:w===a.value.currentImageIndex}]),onClick:Et=>H(w)},null,10,We))),128))])])):D("",!0)],32),t("div",Xe,[t("div",Ye,[t("div",Ze,[t("h2",null,d(a.value.name),1),t("p",He,d(a.value.description),1),t("div",et,[t("div",tt,[s(m,null,{default:o(()=>[s(x(Ie))]),_:1}),t("span",null,"最多"+d(a.value.maxGuests)+"人",1)]),t("div",at,[s(m,null,{default:o(()=>[s(x(be))]),_:1}),t("span",null,d(a.value.area)+"㎡",1)]),a.value.bedSummary||a.value.bedType?(u(),c("div",st,[t("span",null,d(a.value.bedSummary||a.value.bedType),1)])):D("",!0)])]),t("div",ot,[e[13]||(e[13]=t("h3",null,"预订信息",-1)),s(se,{model:r,rules:Q,ref_key:"bookingFormRef",ref:T,"label-width":"80px"},{default:o(()=>[s(z,{gutter:16},{default:o(()=>[s(b,{span:12},{default:o(()=>[s(p,{label:"入住日期",prop:"checkIn"},{default:o(()=>[s(g,{modelValue:r.checkIn,"onUpdate:modelValue":e[2]||(e[2]=l=>r.checkIn=l),type:"date",placeholder:"选择入住日期",style:{width:"100%"},"disabled-date":W},null,8,["modelValue"])]),_:1})]),_:1}),s(b,{span:12},{default:o(()=>[s(p,{label:"退房日期",prop:"checkOut"},{default:o(()=>[s(g,{modelValue:r.checkOut,"onUpdate:modelValue":e[3]||(e[3]=l=>r.checkOut=l),type:"date",placeholder:"选择退房日期",style:{width:"100%"},"disabled-date":X},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(z,{gutter:16},{default:o(()=>[s(b,{span:12},{default:o(()=>[s(p,{label:"入住人数",prop:"guests"},{default:o(()=>[s(ae,{modelValue:r.guests,"onUpdate:modelValue":e[4]||(e[4]=l=>r.guests=l),placeholder:"选择人数",style:{width:"100%"}},{default:o(()=>[(u(!0),c(N,null,O(a.value.maxGuests,l=>(u(),B(te,{key:l,label:`${l}人`,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(z,{gutter:16},{default:o(()=>[s(b,{span:12},{default:o(()=>[s(p,{label:"联系人",prop:"contactName"},{default:o(()=>[s(P,{modelValue:r.contactName,"onUpdate:modelValue":e[5]||(e[5]=l=>r.contactName=l),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1})]),_:1}),s(b,{span:12},{default:o(()=>[s(p,{label:"联系电话",prop:"contactPhone"},{default:o(()=>[s(P,{modelValue:r.contactPhone,"onUpdate:modelValue":e[6]||(e[6]=l=>r.contactPhone=l),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(p,{label:"特殊要求"},{default:o(()=>[s(P,{modelValue:r.specialRequests,"onUpdate:modelValue":e[7]||(e[7]=l=>r.specialRequests=l),type:"textarea",rows:3,placeholder:"如有特殊要求请在此说明（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),a.value.features&&a.value.features.length>0?(u(),c("div",lt,[e[14]||(e[14]=t("h4",null,"房间设施",-1)),t("div",nt,[(u(!0),c(N,null,O(a.value.features,l=>(u(),B(oe,{key:l,type:"info",size:"large",class:"facility-tag"},{default:o(()=>[h(d(l),1)]),_:2},1024))),128))])])):D("",!0),t("div",rt,[e[16]||(e[16]=t("h4",null,"用户评论",-1)),f.value.length===0&&!C.value?(u(),c("div",it,[s(le,{description:"还没有评论，快来抢沙发吧"})])):(u(),c("div",ut,[(u(!0),c(N,null,O(f.value,l=>(u(),c("div",{class:"review-item",key:l.id},[t("div",ct,[s(ne,{size:40},{default:o(()=>[h(d((l.userDisplayName||"匿").slice(0,1)),1)]),_:2},1024),t("div",dt,[t("div",mt,d(l.userDisplayName||"匿名用户"),1),s(re,{modelValue:l.rating,"onUpdate:modelValue":w=>l.rating=w,disabled:"",max:5},null,8,["modelValue","onUpdate:modelValue"]),t("div",pt,d(new Date(l.createTime).toLocaleString("zh-CN")),1)])]),t("div",gt,d(l.content),1)]))),128)),f.value.length<_.value.total?(u(),c("div",vt,[s(n,{loading:C.value,onClick:e[8]||(e[8]=()=>{_.value.current++,M(!1)})},{default:o(()=>[...e[15]||(e[15]=[h("加载更多",-1)])]),_:1},8,["loading"])])):D("",!0)]))])]),t("div",_t,[t("div",ft,[e[23]||(e[23]=t("h3",null,"价格明细",-1)),t("div",kt,[t("div",ht,[e[17]||(e[17]=t("span",null,"房间单价",-1)),t("span",null,"￥"+d(a.value.price)+"/晚",1)]),t("div",yt,[e[18]||(e[18]=t("span",null,"入住天数",-1)),t("span",null,d($.value)+"晚",1)]),t("div",It,[e[19]||(e[19]=t("span",null,"小计",-1)),t("span",null,"￥"+d(U.value),1)]),t("div",bt,[e[20]||(e[20]=t("span",null,"总计",-1)),t("span",null,"￥"+d(F.value),1)])]),t("div",wt,[s(n,{size:"large",onClick:G},{default:o(()=>[...e[21]||(e[21]=[h("取消",-1)])]),_:1}),s(n,{type:"primary",size:"large",onClick:ee,loading:q.value},{default:o(()=>[...e[22]||(e[22]=[h(" 确认预订 ",-1)])]),_:1},8,["loading"])])])])])]),_:1}))])])])}}},jt=Pe(xt,[["__scopeId","data-v-e8149383"]]);export{jt as default};
