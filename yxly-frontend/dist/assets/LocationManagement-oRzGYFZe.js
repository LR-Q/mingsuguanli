/* empty css                  *//* empty css                   *//* empty css                *//* empty css               *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                       *//* empty css               *//* empty css                        *//* empty css                 *//* empty css                 */import{c as be,r as v,l as W,j as ye,z as $,B as i,R as l,J as o,u as g,O as p,P as y,I as M,L as A,A as w,Q as ke,a6 as Me,E as Ve,W as S,n as Ce}from"./vendor-DSBWSuTS.js";import{E as u,j as Le,O as Y,n as Be,e as Ee,p as Ae,am as he,ao as Q,o as xe,ap as Se,aq as Pe,d as Te,Y as Ge,Z as Ue,D as ze,a3 as Ie,ad as Re,k as Oe,R as Ne,a0 as $e,F as Ze,ar as qe,as as Fe,_ as De,at as je,a as H}from"./elementPlus-fsp5CJhs.js";import{a as Ke,u as Je,c as We,t as Ye,d as Qe}from"./location-CQT2kf5E.js";import{_ as He,u as Xe}from"./index-rlk3mQiZ.js";const el={class:"location-map-management"},ll={class:"map-toolbar"},tl={class:"toolbar-left"},al={class:"toolbar-right"},ol={class:"main-content"},nl={class:"map-section"},sl={class:"map-tips"},dl={class:"form-panel"},il={class:"panel-header"},rl={class:"panel-content"},ul={class:"location-list"},pl={key:1,class:"location-cards"},cl={class:"card-header"},ml={class:"location-name"},fl={class:"card-content"},vl={class:"card-actions"},_l={__name:"LocationManagement",setup(gl){const X=Xe(),P=be(()=>X.userInfo),V=t=>P.value?P.value.roleCode==="SUPER_ADMIN"?!0:t.merchantId===P.value.merchantId:!1,T=v(!1),G=v(!1),b=v([]),U=v(null),k=v(!1),C=v(null),m=v(!1),h=v(""),L=v(!1),z=v(null);v(null);let d=null,I=[],c=null,R=null;const B=W({current:1,size:10,total:0}),n=W({name:"",address:"",province:"",city:"",district:"",longitude:null,latitude:null,contactPhone:"",description:"",mapType:"baidu",isActive:1}),ee={name:[{required:!0,message:"请输入位置名称",trigger:"blur"}],address:[{required:!0,message:"请输入详细地址",trigger:"blur"}],longitude:[{required:!0,message:"请输入经度",trigger:"blur"},{type:"number",message:"经度必须为数字",trigger:"blur"}],latitude:[{required:!0,message:"请输入纬度",trigger:"blur"},{type:"number",message:"纬度必须为数字",trigger:"blur"}]},E=async()=>{T.value=!0;try{const t={current:B.current,size:B.size},e=await Ke(t);e.data&&(b.value=e.data.records||[],B.total=e.data.total||0,setTimeout(()=>{q()},100))}catch(t){console.error("获取位置列表失败:",t),u.error("获取位置列表失败")}finally{T.value=!1}},O=()=>{n.name="",n.address="",n.province="",n.city="",n.district="",n.longitude=null,n.latitude=null,n.contactPhone="",n.description="",n.mapType="baidu",n.isActive=1,m.value=!1},Z=t=>{if(O(),k.value=!0,C.value=t.id,m.value=!V(t),Object.keys(n).forEach(e=>{t[e]!==void 0&&t[e]!==null&&(n[e]=t[e])}),d&&t.longitude&&t.latitude){const e=new window.BMapGL.Point(t.longitude,t.latitude);c&&d.removeOverlay(c),c=new window.BMapGL.Marker(e),d.addOverlay(c),d.centerAndZoom(e,16)}L.value=!1,m.value?u.info("您只能查看此位置信息，无权编辑"):u.info("可以在右侧编辑位置信息")},le=async()=>{U.value&&await U.value.validate(async t=>{if(t){G.value=!0;try{k.value?(await Je(C.value,n),u.success("更新成功")):(await We(n),u.success("添加成功")),F(),E()}catch(e){u.error(e.message||"操作失败")}finally{G.value=!1}}})},te=async t=>{const e=t.isActive===1?0:1,s=e===1?"启用":"禁用";try{await H.confirm(`确定要${s}该位置吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ye(t.id,e),u.success(`${s}成功`),E()}catch(r){r!=="cancel"&&u.error(r.message||"操作失败")}},ae=async t=>{try{await H.confirm(`确定要删除位置 "${t.name}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}),await Qe(t.id),u.success("删除成功"),b.value.length===1&&B.current>1&&B.current--,E()}catch(e){e!=="cancel"&&u.error(e.message||"删除失败")}},oe=()=>{E()},ne=async()=>{if(!window.BMapGL)try{await j()}catch(t){console.error("地图API加载失败:",t);return}Ce(()=>{if(!window.BMapGL||d)return;d=new window.BMapGL.Map("main-map");const t=new window.BMapGL.Point(116.404,39.915);d.centerAndZoom(t,12),d.enableScrollWheelZoom(!0),d.addControl(new window.BMapGL.NavigationControl),d.addControl(new window.BMapGL.ScaleControl),R||(R=new window.BMapGL.Geocoder),d.addEventListener("click",e=>{const s=e.latlng;se(s)}),q()})},q=()=>{if(d&&(I.forEach(t=>d.removeOverlay(t)),I=[],b.value.forEach(t=>{if(t.longitude&&t.latitude){const e=new window.BMapGL.Point(t.longitude,t.latitude),s=new window.BMapGL.Marker(e),r=new window.BMapGL.Label(t.name,{position:e,offset:new window.BMapGL.Size(10,-20)});r.setStyle({color:"#333",fontSize:"12px",border:"1px solid #409eff",padding:"2px 5px",borderRadius:"3px",backgroundColor:"#fff"}),s.setLabel(r),s.addEventListener("click",()=>{z.value=t,D(t)}),d.addOverlay(s),I.push(s)}}),b.value.length>0&&b.value[0].longitude)){const t=new window.BMapGL.Point(b.value[0].longitude,b.value[0].latitude);d.centerAndZoom(t,14)}},se=t=>{c&&d.removeOverlay(c),c=new window.BMapGL.Marker(t),c.setAnimation(window.BMAP_ANIMATION_BOUNCE),setTimeout(()=>{c.setAnimation(null)},1e3),d.addOverlay(c),d.panTo(t),R.getLocation(t,e=>{e&&(k.value=!1,C.value=null,n.longitude=t.lng,n.latitude=t.lat,n.address=e.address,n.province=e.addressComponents.province,n.city=e.addressComponents.city,n.district=e.addressComponents.district,u.success("位置已选择，请在右侧填写信息"))})},F=()=>{O(),k.value=!1,C.value=null,c&&(d.removeOverlay(c),c=null),u.info("表单已清空")},D=t=>{if(z.value=t,d&&t.longitude&&t.latitude){const e=new window.BMapGL.Point(t.longitude,t.latitude);d.centerAndZoom(e,16),d.panTo(e)}},de=()=>{if(!h.value){u.warning("请输入搜索关键词");return}if(!d){u.error("地图未初始化");return}const t=new window.BMapGL.LocalSearch(d,{onSearchComplete:e=>{if(t.getStatus()===window.BMAP_STATUS_SUCCESS){const s=e.getPoi(0);if(s){const r=s.point;d.centerAndZoom(r,16),u.success("定位成功")}else u.warning("未找到相关地址")}else u.error("搜索失败，请重试")}});t.search(h.value)},ie=()=>{O(),k.value=!1,C.value=null,c&&(d.removeOverlay(c),c=null),u.info("请在地图上点击选择位置")};ye(async()=>{await j(),await E(),setTimeout(()=>{ne()},500)});const j=()=>window.BMapGL?Promise.resolve():new Promise((t,e)=>{window.onBMapCallback=()=>{t(),console.log("百度地图API加载成功")};const s=document.createElement("script");s.type="text/javascript",s.src="https://api.map.baidu.com/api?v=1.0&type=webgl&ak=bLJae13fqsY9klnNNJxkEk0StqFRZKNK&callback=onBMapCallback",s.onerror=()=>{e(new Error("百度地图API加载失败")),u.error(`百度地图API加载失败，请检查：
1. 网络连接
2. AK配置
3. Referer白名单`)},document.head.appendChild(s)});return(t,e)=>{const s=Be,r=Le,_=Ee,re=xe,ue=Pe,f=Te,K=Ue,pe=Ge,N=Ie,ce=ze,me=Re,fe=Oe,ve=Ne,_e=De,ge=$e,we=je;return w(),$("div",el,[i("div",ll,[i("div",tl,[e[16]||(e[16]=i("h2",null,"位置管理",-1)),l(_,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),placeholder:"搜索地址定位",style:{width:"300px","margin-left":"20px"},clearable:""},{prefix:o(()=>[l(s,null,{default:o(()=>[l(g(Y))]),_:1})]),append:o(()=>[l(r,{onClick:de,icon:g(Y)},{default:o(()=>[...e[15]||(e[15]=[p("搜索",-1)])]),_:1},8,["icon"])]),_:1},8,["modelValue"])]),i("div",al,[l(r,{type:"primary",onClick:ie},{default:o(()=>[l(s,null,{default:o(()=>[l(g(Ae))]),_:1}),e[17]||(e[17]=p(" 添加位置 ",-1))]),_:1}),l(r,{onClick:oe,loading:T.value},{default:o(()=>[l(s,null,{default:o(()=>[l(g(he))]),_:1}),e[18]||(e[18]=p(" 刷新 ",-1))]),_:1},8,["loading"]),l(r,{onClick:e[1]||(e[1]=a=>L.value=!0)},{default:o(()=>[l(s,null,{default:o(()=>[l(g(Q))]),_:1}),e[19]||(e[19]=p(" 位置列表 ",-1))]),_:1})])]),i("div",ol,[i("div",nl,[e[20]||(e[20]=i("div",{id:"main-map",class:"main-map"},null,-1)),i("div",sl,[l(re,{title:"点击地图选择位置，在右侧表单中编辑信息",type:"info",closable:!1})])]),i("div",dl,[i("div",il,[i("h3",null,y(m.value?"查看位置":k.value?"编辑位置":"添加位置"),1),l(ue,null,{default:o(()=>[l(r,{size:"small",onClick:F},{default:o(()=>[l(s,null,{default:o(()=>[l(g(Se))]),_:1}),e[21]||(e[21]=p(" 清空 ",-1))]),_:1}),l(r,{size:"small",onClick:e[2]||(e[2]=a=>L.value=!0)},{default:o(()=>[l(s,null,{default:o(()=>[l(g(Q))]),_:1}),e[22]||(e[22]=p(" 列表 ",-1))]),_:1})]),_:1})]),i("div",rl,[l(fe,{ref_key:"formRef",ref:U,model:n,rules:ee,"label-width":"90px","label-position":"left",size:"default"},{default:o(()=>[l(f,{label:"位置名称",prop:"name"},{default:o(()=>[l(_,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=a=>n.name=a),placeholder:"请输入位置名称",disabled:m.value},null,8,["modelValue","disabled"])]),_:1}),l(f,{label:"详细地址",prop:"address"},{default:o(()=>[l(_,{modelValue:n.address,"onUpdate:modelValue":e[4]||(e[4]=a=>n.address=a),type:"textarea",rows:2,placeholder:"点击地图自动获取地址",disabled:m.value},null,8,["modelValue","disabled"])]),_:1}),l(f,{label:"省份",prop:"province"},{default:o(()=>[l(_,{modelValue:n.province,"onUpdate:modelValue":e[5]||(e[5]=a=>n.province=a),placeholder:"省份",disabled:m.value},null,8,["modelValue","disabled"])]),_:1}),l(f,{label:"城市",prop:"city"},{default:o(()=>[l(_,{modelValue:n.city,"onUpdate:modelValue":e[6]||(e[6]=a=>n.city=a),placeholder:"城市",disabled:m.value},null,8,["modelValue","disabled"])]),_:1}),l(f,{label:"区县",prop:"district"},{default:o(()=>[l(_,{modelValue:n.district,"onUpdate:modelValue":e[7]||(e[7]=a=>n.district=a),placeholder:"区县",disabled:m.value},null,8,["modelValue","disabled"])]),_:1}),l(pe,{gutter:10},{default:o(()=>[l(K,{span:12},{default:o(()=>[l(f,{label:"经度",prop:"longitude"},{default:o(()=>[l(_,{modelValue:n.longitude,"onUpdate:modelValue":e[8]||(e[8]=a=>n.longitude=a),modelModifiers:{number:!0},placeholder:"经度",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(K,{span:12},{default:o(()=>[l(f,{label:"纬度",prop:"latitude"},{default:o(()=>[l(_,{modelValue:n.latitude,"onUpdate:modelValue":e[9]||(e[9]=a=>n.latitude=a),modelModifiers:{number:!0},placeholder:"纬度",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(f,{label:"联系电话",prop:"contactPhone"},{default:o(()=>[l(_,{modelValue:n.contactPhone,"onUpdate:modelValue":e[10]||(e[10]=a=>n.contactPhone=a),placeholder:"请输入联系电话",disabled:m.value},null,8,["modelValue","disabled"])]),_:1}),l(f,{label:"地图类型",prop:"mapType"},{default:o(()=>[l(ce,{modelValue:n.mapType,"onUpdate:modelValue":e[11]||(e[11]=a=>n.mapType=a),disabled:m.value},{default:o(()=>[l(N,{label:"baidu"},{default:o(()=>[...e[23]||(e[23]=[p("百度",-1)])]),_:1}),l(N,{label:"amap"},{default:o(()=>[...e[24]||(e[24]=[p("高德",-1)])]),_:1}),l(N,{label:"google"},{default:o(()=>[...e[25]||(e[25]=[p("谷歌",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(f,{label:"位置描述",prop:"description"},{default:o(()=>[l(_,{modelValue:n.description,"onUpdate:modelValue":e[12]||(e[12]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入位置描述",disabled:m.value},null,8,["modelValue","disabled"])]),_:1}),l(f,{label:"是否启用",prop:"isActive"},{default:o(()=>[l(me,{modelValue:n.isActive,"onUpdate:modelValue":e[13]||(e[13]=a=>n.isActive=a),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用",disabled:m.value},null,8,["modelValue","disabled"])]),_:1}),m.value?A("",!0):(w(),M(f,{key:0},{default:o(()=>[l(r,{type:"primary",onClick:le,loading:G.value,style:{width:"100%"}},{default:o(()=>[p(y(k.value?"更新位置":"保存位置"),1)]),_:1},8,["loading"])]),_:1}))]),_:1},8,["model"])])])]),l(we,{modelValue:L.value,"onUpdate:modelValue":e[14]||(e[14]=a=>L.value=a),title:"位置列表",direction:"rtl",size:"400px"},{default:o(()=>[i("div",ul,[b.value.length===0?(w(),M(ve,{key:0,description:"暂无位置数据"})):(w(),$("div",pl,[(w(!0),$(ke,null,Me(b.value,a=>{var J;return w(),M(ge,{key:a.id,class:Ve(["location-card",{active:((J=z.value)==null?void 0:J.id)===a.id}]),onClick:x=>D(a)},{header:o(()=>[i("div",cl,[i("span",ml,y(a.name),1),l(_e,{type:a.isActive===1?"success":"info",size:"small"},{default:o(()=>[p(y(a.isActive===1?"启用":"禁用"),1)]),_:2},1032,["type"])])]),footer:o(()=>[i("div",vl,[V(a)?A("",!0):(w(),M(r,{key:0,size:"small",onClick:S(x=>Z(a),["stop"])},{default:o(()=>[...e[26]||(e[26]=[p(" 查看 ",-1)])]),_:1},8,["onClick"])),V(a)?(w(),M(r,{key:1,size:"small",type:"primary",onClick:S(x=>Z(a),["stop"])},{default:o(()=>[...e[27]||(e[27]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"])):A("",!0),V(a)?(w(),M(r,{key:2,size:"small",type:a.isActive===1?"warning":"success",onClick:S(x=>te(a),["stop"])},{default:o(()=>[p(y(a.isActive===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])):A("",!0),V(a)?(w(),M(r,{key:3,size:"small",type:"danger",onClick:S(x=>ae(a),["stop"])},{default:o(()=>[...e[28]||(e[28]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])):A("",!0)])]),default:o(()=>[i("div",fl,[i("p",null,[l(s,null,{default:o(()=>[l(g(Ze))]),_:1}),p(" "+y(a.address),1)]),i("p",null,[l(s,null,{default:o(()=>[l(g(qe))]),_:1}),p(" "+y(a.contactPhone||"-"),1)]),i("p",null,[l(s,null,{default:o(()=>[l(g(Fe))]),_:1}),p(" "+y(a.longitude)+", "+y(a.latitude),1)])])]),_:2},1032,["class","onClick"])}),128))]))])]),_:1},8,["modelValue"])])}}},Gl=He(_l,[["__scopeId","data-v-215452d3"]]);export{Gl as default};
