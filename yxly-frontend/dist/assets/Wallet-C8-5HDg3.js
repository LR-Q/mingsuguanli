/* empty css                  *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                 *//* empty css                    *//* empty css                        *//* empty css                       *//* empty css                        *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                             *//* empty css                */import{n as fe,w as ge,j as ye,p as J,a4 as _e,a0 as ve,L as we,K as be,P as he,a5 as Te,a6 as Ve,_ as Ee,a7 as Re,k as ke,d as Pe,a8 as xe,D as Ue,a3 as Ce,m as Me,U as ze,e as Se,o as Fe,S as De,E as f}from"./elementPlus-fsp5CJhs.js";import{d as E,_ as Ie}from"./index-rlk3mQiZ.js";import{b as Ne}from"./user-DKsE4N4d.js";import{r as g,l as N,c as $e,j as Be,z as $,R as a,J as l,B as s,u as M,A as x,P as V,O as d,E as Oe,I as K}from"./vendor-DSBWSuTS.js";function We(p){return E({url:"/api/v1/user/recharge/apply",method:"POST",data:p})}function je(p){return E({url:"/api/v1/user/recharge/records",method:"GET",params:p})}function qe(p){return E({url:"/api/v1/admin/files/upload/payment-proof",method:"POST",data:p,headers:{"Content-Type":"multipart/form-data"}})}function Ge(p){return E({url:"/api/v1/user/recharge/withdraw/apply",method:"POST",data:p})}function Le(p){return E({url:"/api/v1/user/recharge/withdraw/records",method:"GET",params:p})}function Ae(p){return E({url:"/api/v1/user/financial-records/my",method:"GET",params:p})}const Je={class:"wallet-page"},Ke={class:"balance-info"},He={class:"balance-icon"},Qe={class:"balance-content"},Xe={key:0,class:"balance-amount"},Ye={key:1,class:"balance-amount"},Ze={class:"balance-actions"},ea={class:"transactions-section"},aa={class:"section-header"},ta={class:"filters"},la={class:"pagination-wrapper"},oa={class:"balance-tip"},na={__name:"Wallet",setup(p){const R=g(!1),k=g(!1),z=g(!1),B=g(),U=g("all"),O=g([]),w=g(1),P=g(10),W=g(0),y=N({balance:0}),S=g(!1),u=N({amount:null,paymentMethod:"支付宝",paymentProof:"",userRemark:""}),H={amount:[{required:!0,message:"请输入充值金额",trigger:"blur"},{type:"number",min:1,max:1e4,message:"充值金额必须在1-10000元之间",trigger:"blur"}],paymentMethod:[{required:!0,message:"请选择支付方式",trigger:"change"}],paymentProof:[{required:!0,message:"请上传支付凭证",trigger:"change"}]},m=N({amount:null,method:"支付宝"}),Q=[],F=g([]),X=$e(()=>{let t=F.value;return U.value!=="all"&&(t=t.filter(e=>e.type===U.value)),t}),D=t=>t.toFixed(2),Y=t=>({recharge:"充值",consume:"消费",refund:"退款",withdraw:"提现"})[t]||t,Z=t=>({recharge:"success",consume:"warning",refund:"info",withdraw:"danger"})[t]||"",ee=t=>({success:"成功",pending:"处理中",failed:"失败"})[t]||t,ae=t=>({success:"success",pending:"warning",failed:"danger"})[t]||"",te=t=>{P.value=t},le=t=>{w.value=t},oe=async t=>{var e,i;try{const r=new FormData;r.append("file",t.file);const _=await qe(r);u.paymentProof=_.data,t.onSuccess(_,t.file),f.success("支付凭证上传成功")}catch(r){console.error("支付凭证上传失败:",r),f.error("支付凭证上传失败: "+(((i=(e=r.response)==null?void 0:e.data)==null?void 0:i.message)||r.message)),t.onError(r,t.file)}},ne=t=>{const e=t.type.startsWith("image/"),i=t.size/1024/1024<10;return e?i?!0:(f.error("图片大小不能超过 10MB!"),!1):(f.error("只能上传图片文件!"),!1)},se=async()=>{var t,e;try{await B.value.validate(),z.value=!0,await We({amount:u.amount,paymentMethod:u.paymentMethod,paymentProof:u.paymentProof,userRemark:u.userRemark}),f.success("充值申请提交成功，请等待管理员审核"),R.value=!1,Object.assign(u,{amount:null,paymentMethod:"支付宝",paymentProof:"",userRemark:""}),I()}catch(i){console.error("充值申请失败:",i),(e=(t=i.response)==null?void 0:t.data)!=null&&e.message?f.error("充值申请失败: "+i.response.data.message):f.error("充值申请失败，请重试")}finally{z.value=!1}},I=async()=>{try{const[t,e,i]=await Promise.all([je({current:w.value,size:P.value}),Le({current:w.value,size:P.value}),Ae({current:w.value,size:1e3})]),r=t.data.records.map(n=>({id:`R${n.id}`,type:"recharge",amount:n.amount,description:`充值申请 - ${n.statusName}`,status:n.status===1?"success":n.status===0?"pending":"failed",createTime:n.applyTime})),_=e.data.records.map(n=>({id:`W${n.id}`,type:"withdraw",amount:n.amount,description:`提现申请 - ${n.statusDesc}`,status:n.status===1?"success":n.status===0?"pending":"failed",createTime:n.applyTime})),v=(i.data.records||[]).map(n=>{let c="consume",b=n.description||"交易";return n.category==="CONSUMPTION"?(c="consume",b=n.description||"订房消费"):n.category==="REFUND"&&(c="refund",b=n.description||"退款"),{id:n.recordNo||`F${n.id}`,type:c,amount:n.amount,description:b,status:"success",createTime:n.createTime||n.recordDate}}),C=[...r,..._,...v,...Q];C.sort((n,c)=>new Date(c.createTime)-new Date(n.createTime)),F.value=C,W.value=F.value.length}catch(t){console.error("加载交易记录失败:",t)}},j=async()=>{S.value=!0;try{const{data:t}=await Ne();y.balance=parseFloat(t)||0,console.log("从后端获取余额:",y.balance)}catch(t){console.error("加载用户余额失败:",t),y.balance=0,console.log("后端不可用，设置默认余额为0")}finally{S.value=!1}},re=async()=>{try{if(m.amount>y.balance){f.error("提现金额不能超过账户余额");return}if(y.balance===0){f.error("账户余额为0，无法提现");return}const t={amount:m.amount,withdrawMethod:m.method,accountInfo:`${m.method}账户`,userRemark:""};await Ge(t),await j(),await I(),f.success(`提现申请已提交，金额：¥${m.amount}，请等待管理员审核`),k.value=!1,m.amount=null,m.method="支付宝"}catch(t){console.error("提现申请失败:",t),f.error("提现申请失败，请重试")}};return Be(()=>{j(),I()}),(t,e)=>{const i=fe,r=ye,_=ve,v=be,C=we,n=he,c=Ve,b=Ee,ue=Te,ie=Re,q=xe,h=Pe,T=Ce,G=Ue,de=ze,pe=Me,me=Se,ce=Fe,L=ke,A=De;return x(),$("div",Je,[a(_,{class:"balance-card",shadow:"never"},{default:l(()=>[s("div",Ke,[s("div",He,[a(i,null,{default:l(()=>[a(M(ge))]),_:1})]),s("div",Qe,[e[15]||(e[15]=s("h3",null,"账户余额",-1)),S.value?(x(),$("p",Ye,"加载中...")):(x(),$("p",Xe,"¥"+V(D(y.balance)),1))]),s("div",Ze,[a(r,{type:"primary",onClick:e[0]||(e[0]=o=>R.value=!0)},{default:l(()=>[a(i,null,{default:l(()=>[a(M(J))]),_:1}),e[16]||(e[16]=d(" 充值 ",-1))]),_:1}),a(r,{onClick:e[1]||(e[1]=o=>k.value=!0)},{default:l(()=>[a(i,null,{default:l(()=>[a(M(_e))]),_:1}),e[17]||(e[17]=d(" 提现 ",-1))]),_:1})])])]),_:1}),a(_,{class:"details-card",shadow:"never"},{default:l(()=>[s("div",ea,[s("div",aa,[e[18]||(e[18]=s("h3",null,"交易记录",-1)),s("div",ta,[a(C,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=o=>U.value=o),placeholder:"交易类型",style:{width:"120px"}},{default:l(()=>[a(v,{label:"全部",value:"all"}),a(v,{label:"充值",value:"recharge"}),a(v,{label:"消费",value:"consume"}),a(v,{label:"退款",value:"refund"}),a(v,{label:"提现",value:"withdraw"})]),_:1},8,["modelValue"]),a(n,{modelValue:O.value,"onUpdate:modelValue":e[3]||(e[3]=o=>O.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px","margin-left":"12px"}},null,8,["modelValue"])])]),a(ue,{data:X.value,style:{width:"100%"}},{default:l(()=>[a(c,{prop:"id",label:"交易单号",width:"180"}),a(c,{prop:"type",label:"交易类型",width:"100"},{default:l(({row:o})=>[a(b,{type:Z(o.type)},{default:l(()=>[d(V(Y(o.type)),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"amount",label:"金额",width:"120"},{default:l(({row:o})=>[s("span",{class:Oe(o.type==="recharge"||o.type==="refund"?"income":"expense")},V(o.type==="recharge"||o.type==="refund"?"+":"-")+"¥"+V(D(o.amount)),3)]),_:1}),a(c,{prop:"description",label:"交易说明"}),a(c,{prop:"status",label:"状态",width:"100"},{default:l(({row:o})=>[a(b,{type:ae(o.status)},{default:l(()=>[d(V(ee(o.status)),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"createTime",label:"交易时间",width:"180"})]),_:1},8,["data"]),s("div",la,[a(ie,{"current-page":w.value,"onUpdate:currentPage":e[4]||(e[4]=o=>w.value=o),"page-size":P.value,"onUpdate:pageSize":e[5]||(e[5]=o=>P.value=o),"page-sizes":[10,20,50,100],total:W.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:te,onCurrentChange:le},null,8,["current-page","page-size","total"])])])]),_:1}),a(A,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=o=>R.value=o),title:"申请充值",width:"600px"},{footer:l(()=>[a(r,{onClick:e[9]||(e[9]=o=>R.value=!1)},{default:l(()=>[...e[25]||(e[25]=[d("取消",-1)])]),_:1}),a(r,{type:"primary",onClick:se,loading:z.value},{default:l(()=>[...e[26]||(e[26]=[d(" 提交申请 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(L,{model:u,rules:H,ref_key:"rechargeFormRef",ref:B,"label-width":"100px"},{default:l(()=>[a(h,{label:"充值金额",prop:"amount"},{default:l(()=>[a(q,{modelValue:u.amount,"onUpdate:modelValue":e[6]||(e[6]=o=>u.amount=o),min:1,max:1e4,precision:2,style:{width:"100%"},placeholder:"请输入充值金额"},null,8,["modelValue"]),e[19]||(e[19]=s("div",{class:"form-tip"},"最低充值1元，最高10000元",-1))]),_:1}),a(h,{label:"支付方式",prop:"paymentMethod"},{default:l(()=>[a(G,{modelValue:u.paymentMethod,"onUpdate:modelValue":e[7]||(e[7]=o=>u.paymentMethod=o)},{default:l(()=>[a(T,{label:"支付宝"},{default:l(()=>[...e[20]||(e[20]=[d("支付宝",-1)])]),_:1}),a(T,{label:"微信支付"},{default:l(()=>[...e[21]||(e[21]=[d("微信支付",-1)])]),_:1}),a(T,{label:"银行转账"},{default:l(()=>[...e[22]||(e[22]=[d("银行转账",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(h,{label:"支付凭证",prop:"paymentProof"},{default:l(()=>[a(pe,{class:"proof-uploader","auto-upload":!0,"show-file-list":!1,"http-request":oe,"before-upload":ne,accept:"image/*"},{default:l(()=>[u.paymentProof?(x(),K(de,{key:0,src:u.paymentProof,class:"proof-image",fit:"cover"},null,8,["src"])):(x(),K(i,{key:1,class:"proof-uploader-icon"},{default:l(()=>[a(M(J))]),_:1}))]),_:1}),e[23]||(e[23]=s("div",{class:"form-tip"},"请上传支付截图或转账凭证，支持jpg、png格式，大小不超过10MB",-1))]),_:1}),a(h,{label:"备注说明"},{default:l(()=>[a(me,{modelValue:u.userRemark,"onUpdate:modelValue":e[8]||(e[8]=o=>u.userRemark=o),type:"textarea",rows:3,placeholder:"请输入备注说明（可选）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(ce,{title:"充值说明",type:"info",closable:!1,"show-icon":""},{default:l(()=>[...e[24]||(e[24]=[s("p",null,"1. 请先完成支付，然后上传支付凭证",-1),s("p",null,"2. 管理员将在1-3个工作日内审核您的充值申请",-1),s("p",null,"3. 审核通过后，金额将自动充值到您的账户",-1)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(A,{modelValue:k.value,"onUpdate:modelValue":e[14]||(e[14]=o=>k.value=o),title:"账户提现",width:"500px"},{footer:l(()=>[a(r,{onClick:e[13]||(e[13]=o=>k.value=!1)},{default:l(()=>[...e[30]||(e[30]=[d("取消",-1)])]),_:1}),a(r,{type:"primary",onClick:re},{default:l(()=>[...e[31]||(e[31]=[d("确认提现",-1)])]),_:1})]),default:l(()=>[a(L,{model:m,"label-width":"80px"},{default:l(()=>[a(h,{label:"提现金额"},{default:l(()=>[a(q,{modelValue:m.amount,"onUpdate:modelValue":e[11]||(e[11]=o=>m.amount=o),min:1,max:y.balance,precision:2,style:{width:"100%"}},null,8,["modelValue","max"]),s("div",oa," 可提现余额：¥"+V(D(y.balance)),1)]),_:1}),a(h,{label:"提现方式"},{default:l(()=>[a(G,{modelValue:m.method,"onUpdate:modelValue":e[12]||(e[12]=o=>m.method=o)},{default:l(()=>[a(T,{label:"支付宝"},{default:l(()=>[...e[27]||(e[27]=[d("支付宝",-1)])]),_:1}),a(T,{label:"微信"},{default:l(()=>[...e[28]||(e[28]=[d("微信",-1)])]),_:1}),a(T,{label:"银行卡"},{default:l(()=>[...e[29]||(e[29]=[d("银行卡",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ua=Ie(na,[["__scopeId","data-v-b0ec6f76"]]);export{Ua as default};
