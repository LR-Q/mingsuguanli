/* empty css                  *//* empty css                  *//* empty css                   *//* empty css                             *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     */import{r as y,l as S,j as J,z as D,B as c,R as e,J as a,a4 as H,u as z,O as o,P as r,L as Q,A as I}from"./vendor-DSBWSuTS.js";import{d as W,e as X,n as Y,O as $,j as Z,am as ee,k as te,a6 as ae,_ as le,an as ne,a5 as oe,a7 as se,ab as re,ac as ie,S as ue,E as h,a as de}from"./elementPlus-fsp5CJhs.js";import{d as T,_ as ce}from"./index-rlk3mQiZ.js";function me(m){return T({url:"/api/v1/admin/customers",method:"GET",params:m})}function pe(m,p){return T({url:`/api/v1/admin/customers/${m}/status`,method:"PUT",params:{status:p}})}function _e(m){return T({url:`/api/v1/admin/customers/${m}`,method:"DELETE"})}const fe={class:"customer-management"},ge={class:"search-section"},ve={class:"table-section"},ye={class:"pagination-section"},he={key:0,class:"customer-detail"},be={__name:"CustomerManagement",setup(m){const p=y(!1),w=y([]),B=y([]),b=y(!1),i=y(null),v=S({keyword:""}),s=S({current:1,size:10,total:0}),_=async()=>{try{p.value=!0;const n={current:s.current,size:s.size,keyword:v.keyword||void 0},t=await me(n);t.data&&(w.value=t.data.records,s.total=t.data.total,s.current=t.data.current,s.size=t.data.size)}catch(n){console.error("获取客户列表失败:",n),h.error("获取客户列表失败")}finally{p.value=!1}},k=()=>{s.current=1,_()},L=()=>{v.keyword="",s.current=1,_()},P=n=>{s.size=n,s.current=1,_()},M=n=>{s.current=n,_()},U=n=>{B.value=n},N=n=>{i.value=n,b.value=!0},j=async n=>{const t=n.status===1?0:1,f=t===1?"启用":"禁用";try{await de.confirm(`确定要${f}客户 "${n.username}" 吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pe(n.id,t),h.success(`${f}成功`),n.status=t,n.statusText=t===1?"正常":"禁用"}catch(C){C!=="cancel"&&(console.error("状态更新失败:",C),h.error("状态更新失败"))}},F=async n=>{try{console.log("开始删除客户:",n.id,n.username);const t=await _e(n.id);console.log("删除API响应:",t),h.success("删除成功"),await _()}catch(t){console.error("删除失败详细信息:",t),console.error("错误响应:",t.response),h.error(t.message||"删除失败")}};return J(()=>{_()}),(n,t)=>{const f=Y,C=X,x=W,g=Z,A=te,u=ae,E=le,K=ne,O=oe,R=se,d=ie,q=re,G=ue;return I(),D("div",fe,[t[10]||(t[10]=c("div",{class:"page-header"},[c("h2",null,"客户管理"),c("p",null,"管理所有注册用户信息")],-1)),c("div",ge,[e(A,{inline:!0,model:v,class:"search-form"},{default:a(()=>[e(x,{label:"搜索"},{default:a(()=>[e(C,{modelValue:v.keyword,"onUpdate:modelValue":t[0]||(t[0]=l=>v.keyword=l),placeholder:"输入用户名、姓名、手机号或邮箱",style:{width:"300px"},clearable:"",onKeyup:H(k,["enter"])},{prefix:a(()=>[e(f,null,{default:a(()=>[e(z($))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(x,null,{default:a(()=>[e(g,{type:"primary",onClick:k,loading:p.value},{default:a(()=>[e(f,null,{default:a(()=>[e(z($))]),_:1}),t[5]||(t[5]=o(" 搜索 ",-1))]),_:1},8,["loading"]),e(g,{onClick:L},{default:a(()=>[e(f,null,{default:a(()=>[e(z(ee))]),_:1}),t[6]||(t[6]=o(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),c("div",ve,[e(O,{data:w.value,loading:p.value,stripe:"",style:{width:"100%"},onSelectionChange:U},{default:a(()=>[e(u,{type:"selection",width:"55"}),e(u,{prop:"id",label:"ID",width:"80"}),e(u,{prop:"username",label:"用户名","min-width":"120"},{default:a(({row:l})=>[e(E,{type:"info"},{default:a(()=>[o(r(l.username),1)]),_:2},1024)]),_:1}),e(u,{prop:"phone",label:"手机号","min-width":"130"},{default:a(({row:l})=>[c("span",null,r(l.phone||"-"),1)]),_:1}),e(u,{prop:"email",label:"邮箱","min-width":"180"},{default:a(({row:l})=>[c("span",null,r(l.email||"-"),1)]),_:1}),e(u,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(E,{type:l.status===1?"success":"danger"},{default:a(()=>[o(r(l.statusText),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"lastLoginTime",label:"最后登录","min-width":"160"},{default:a(({row:l})=>[c("span",null,r(l.lastLoginTime||"-"),1)]),_:1}),e(u,{prop:"createTime",label:"注册时间","min-width":"160"}),e(u,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[e(g,{type:"primary",size:"small",onClick:V=>N(l)},{default:a(()=>[...t[7]||(t[7]=[o(" 详情 ",-1)])]),_:1},8,["onClick"]),e(g,{type:l.status===1?"warning":"success",size:"small",onClick:V=>j(l)},{default:a(()=>[o(r(l.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),e(K,{title:"确定要删除这个客户吗？",onConfirm:V=>F(l)},{reference:a(()=>[e(g,{type:"danger",size:"small"},{default:a(()=>[...t[8]||(t[8]=[o(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data","loading"]),c("div",ye,[e(R,{"current-page":s.current,"onUpdate:currentPage":t[1]||(t[1]=l=>s.current=l),"page-size":s.size,"onUpdate:pageSize":t[2]||(t[2]=l=>s.size=l),"page-sizes":[10,20,50,100],total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),e(G,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=l=>b.value=l),title:"客户详情",width:"600px"},{footer:a(()=>[e(g,{onClick:t[3]||(t[3]=l=>b.value=!1)},{default:a(()=>[...t[9]||(t[9]=[o("关闭",-1)])]),_:1})]),default:a(()=>[i.value?(I(),D("div",he,[e(q,{column:2,border:""},{default:a(()=>[e(d,{label:"用户ID"},{default:a(()=>[o(r(i.value.id),1)]),_:1}),e(d,{label:"用户名"},{default:a(()=>[o(r(i.value.username),1)]),_:1}),e(d,{label:"手机号"},{default:a(()=>[o(r(i.value.phone||"-"),1)]),_:1}),e(d,{label:"邮箱"},{default:a(()=>[o(r(i.value.email||"-"),1)]),_:1}),e(d,{label:"状态"},{default:a(()=>[e(E,{type:i.value.status===1?"success":"danger"},{default:a(()=>[o(r(i.value.statusText),1)]),_:1},8,["type"])]),_:1}),e(d,{label:"最后登录时间"},{default:a(()=>[o(r(i.value.lastLoginTime||"-"),1)]),_:1}),e(d,{label:"最后登录IP"},{default:a(()=>[o(r(i.value.lastLoginIp||"-"),1)]),_:1}),e(d,{label:"注册时间"},{default:a(()=>[o(r(i.value.createTime),1)]),_:1}),e(d,{label:"更新时间"},{default:a(()=>[o(r(i.value.updateTime),1)]),_:1})]),_:1})])):Q("",!0)]),_:1},8,["modelValue"])])}}},Ue=ce(be,[["__scopeId","data-v-2ad285e5"]]);export{Ue as default};
