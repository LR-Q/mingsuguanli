/* empty css                  *//* empty css                  *//* empty css                   *//* empty css                    *//* empty css                  *//* empty css                *//* empty css                     *//* empty css                             *//* empty css                 *//* empty css                     *//* empty css                       *//* empty css               */import{_ as T,u as L,i as Y}from"./index-rlk3mQiZ.js";import{u as x,a as H,g as K}from"./user-DKsE4N4d.js";import{k as Q,Y as W,Z as X,d as ee,e as ae,D as le,a3 as re,P as oe,j as se,a0 as te,r as de,m as ne,S as ie,E as m}from"./elementPlus-fsp5CJhs.js";import{r as w,l as U,j as ue,z as pe,R as a,J as l,I as me,L as fe,O as p,A,B as d,P as D}from"./vendor-DSBWSuTS.js";const ge={class:"profile-page"},we={class:"card-header"},ve={class:"avatar-section"},_e={class:"avatar-preview"},be={class:"avatar-actions"},ce={class:"security-items"},Ve={class:"security-item"},ye={__name:"Profile",setup(Pe){const v=L(),f=w(!1),b=w(!1),_=w(!1),c=w(!1),E=w(),N=w(),o=U({username:"",realName:"",email:"",phone:"",gender:0,birthday:null,bio:"",avatar:"",emailVerified:!1,phoneVerified:!1}),I=r=>r?r.replace(/^http:\/\/localhost:9000\/txt\//,"/txt/"):"",V=U({}),n=U({oldPassword:"",newPassword:"",confirmPassword:""}),R={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[A-Za-z0-9_.-]+$/,message:"仅支持字母、数字、._-",trigger:"blur"}],realName:[{min:2,max:20,message:"姓名长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},F={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{6,}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(r,e,t)=>{e!==n.newPassword?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]},j=()=>{const r=v.userInfo;r&&(Object.assign(o,{username:r.username||"",realName:r.realName||"",email:r.email||"",phone:r.phone||"",gender:r.gender||0,birthday:r.birthday?new Date(r.birthday):null,bio:r.bio||"",avatar:r.avatar||"",emailVerified:r.emailVerified||!1,phoneVerified:r.phoneVerified||!1}),Object.assign(V,o))},B=async()=>{try{await E.value.validate(),b.value=!0;const r={username:o.username,realName:o.realName,email:o.email,phone:o.phone,avatar:o.avatar},e=await x(r);m.success("个人信息更新成功"),f.value=!1,e.data&&(v.updateUserInfo(e.data),Object.assign(V,o),e.data.usernameChanged&&(m.warning("用户名已修改，为保证安全将退出重新登录"),setTimeout(()=>v.logout(),1200)))}catch(r){console.error("保存失败:",r),m.error(r.message||"保存失败，请重试")}finally{b.value=!1}},q=()=>{Object.assign(o,V),f.value=!1},z=r=>{const e=r.type==="image/jpeg"||r.type==="image/png",t=r.size/1024/1024<2;return e?t?!0:(m.error("头像大小不能超过 2MB!"),!1):(m.error("头像只能是 JPG/PNG 格式!"),!1)},$=async r=>{try{const e=new FormData;e.append("file",r.file);const t=await H(e);if(t.data&&t.data.url){o.avatar=t.data.url,await x({avatar:t.data.url});const i=await K();i.data&&v.updateUserInfo(i.data),m.success("头像上传成功")}}catch(e){console.error("头像上传失败:",e),m.error(e.message||"头像上传失败，请重试")}},G=async()=>{var r,e;try{await N.value.validate(),c.value=!0,await Y({oldPassword:n.oldPassword,newPassword:n.newPassword}),m.success("密码修改成功，请重新登录"),_.value=!1,Object.assign(n,{oldPassword:"",newPassword:"",confirmPassword:""}),setTimeout(async()=>{await v.logout()},1500)}catch(t){console.error("密码修改失败:",t),(e=(r=t.response)==null?void 0:r.data)!=null&&e.message?m.error(t.response.data.message):m.error("密码修改失败，请检查当前密码是否正确")}finally{c.value=!1}};return ue(()=>{j()}),(r,e)=>{const t=se,i=ae,u=ee,g=X,y=W,P=re,M=le,O=oe,C=Q,h=te,S=de,J=ne,Z=ie;return A(),pe("div",ge,[a(h,{class:"profile-card",shadow:"never"},{header:l(()=>[d("div",we,[e[14]||(e[14]=d("h3",null,"个人信息",-1)),a(t,{type:"primary",onClick:e[0]||(e[0]=s=>f.value=!f.value)},{default:l(()=>[p(D(f.value?"取消编辑":"编辑信息"),1)]),_:1})])]),default:l(()=>[a(C,{ref_key:"profileFormRef",ref:E,model:o,rules:R,"label-width":"100px",disabled:!f.value},{default:l(()=>[a(y,{gutter:24},{default:l(()=>[a(g,{span:12},{default:l(()=>[a(u,{label:"用户名",prop:"username"},{default:l(()=>[a(i,{modelValue:o.username,"onUpdate:modelValue":e[1]||(e[1]=s=>o.username=s),placeholder:"请输入用户名(3-20位，字母数字._-)"},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{span:12},{default:l(()=>[a(u,{label:"真实姓名",prop:"realName"},{default:l(()=>[a(i,{modelValue:o.realName,"onUpdate:modelValue":e[2]||(e[2]=s=>o.realName=s),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(y,{gutter:24},{default:l(()=>[a(g,{span:12},{default:l(()=>[a(u,{label:"邮箱",prop:"email"},{default:l(()=>[a(i,{modelValue:o.email,"onUpdate:modelValue":e[3]||(e[3]=s=>o.email=s),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{span:12},{default:l(()=>[a(u,{label:"手机号",prop:"phone"},{default:l(()=>[a(i,{modelValue:o.phone,"onUpdate:modelValue":e[4]||(e[4]=s=>o.phone=s),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(y,{gutter:24},{default:l(()=>[a(g,{span:12},{default:l(()=>[a(u,{label:"性别",prop:"gender"},{default:l(()=>[a(M,{modelValue:o.gender,"onUpdate:modelValue":e[5]||(e[5]=s=>o.gender=s)},{default:l(()=>[a(P,{label:1},{default:l(()=>[...e[15]||(e[15]=[p("男",-1)])]),_:1}),a(P,{label:2},{default:l(()=>[...e[16]||(e[16]=[p("女",-1)])]),_:1}),a(P,{label:0},{default:l(()=>[...e[17]||(e[17]=[p("保密",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(g,{span:12},{default:l(()=>[a(u,{label:"生日",prop:"birthday"},{default:l(()=>[a(O,{modelValue:o.birthday,"onUpdate:modelValue":e[6]||(e[6]=s=>o.birthday=s),type:"date",placeholder:"选择生日",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(u,{label:"个人简介",prop:"bio"},{default:l(()=>[a(i,{modelValue:o.bio,"onUpdate:modelValue":e[7]||(e[7]=s=>o.bio=s),type:"textarea",rows:4,placeholder:"介绍一下自己吧..."},null,8,["modelValue"])]),_:1}),f.value?(A(),me(u,{key:0},{default:l(()=>[a(t,{type:"primary",onClick:B,loading:b.value},{default:l(()=>[...e[18]||(e[18]=[p(" 保存修改 ",-1)])]),_:1},8,["loading"]),a(t,{onClick:q},{default:l(()=>[...e[19]||(e[19]=[p("取消",-1)])]),_:1})]),_:1})):fe("",!0)]),_:1},8,["model","disabled"])]),_:1}),a(h,{class:"avatar-card",shadow:"never"},{header:l(()=>[...e[20]||(e[20]=[d("h3",null,"头像设置",-1)])]),default:l(()=>[d("div",ve,[d("div",_e,[a(S,{size:120,src:I(o.avatar)},{default:l(()=>{var s,k;return[p(D(((s=o.realName)==null?void 0:s.charAt(0))||((k=o.username)==null?void 0:k.charAt(0))),1)]}),_:1},8,["src"])]),d("div",be,[a(J,{class:"avatar-uploader",action:"#","show-file-list":!1,"before-upload":z,"http-request":$},{default:l(()=>[a(t,{type:"primary"},{default:l(()=>[...e[21]||(e[21]=[p("上传头像",-1)])]),_:1})]),_:1}),e[22]||(e[22]=d("p",{class:"upload-tip"},"支持 JPG、PNG 格式，文件大小不超过 2MB",-1))])])]),_:1}),a(h,{class:"security-card",shadow:"never"},{header:l(()=>[...e[23]||(e[23]=[d("h3",null,"安全设置",-1)])]),default:l(()=>[d("div",ce,[d("div",Ve,[e[25]||(e[25]=d("div",{class:"item-info"},[d("h4",null,"登录密码"),d("p",null,"定期更换密码，保护账户安全")],-1)),a(t,{type:"primary",plain:"",onClick:e[8]||(e[8]=s=>_.value=!0)},{default:l(()=>[...e[24]||(e[24]=[p(" 修改密码 ",-1)])]),_:1})])])]),_:1}),a(Z,{modelValue:_.value,"onUpdate:modelValue":e[13]||(e[13]=s=>_.value=s),title:"修改密码",width:"400px"},{footer:l(()=>[a(t,{onClick:e[12]||(e[12]=s=>_.value=!1)},{default:l(()=>[...e[26]||(e[26]=[p("取消",-1)])]),_:1}),a(t,{type:"primary",onClick:G,loading:c.value},{default:l(()=>[...e[27]||(e[27]=[p(" 确认修改 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(C,{ref_key:"passwordFormRef",ref:N,model:n,rules:F,"label-width":"100px"},{default:l(()=>[a(u,{label:"当前密码",prop:"oldPassword"},{default:l(()=>[a(i,{modelValue:n.oldPassword,"onUpdate:modelValue":e[9]||(e[9]=s=>n.oldPassword=s),type:"password","show-password":"",placeholder:"请输入当前密码"},null,8,["modelValue"])]),_:1}),a(u,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(i,{modelValue:n.newPassword,"onUpdate:modelValue":e[10]||(e[10]=s=>n.newPassword=s),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(u,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(i,{modelValue:n.confirmPassword,"onUpdate:modelValue":e[11]||(e[11]=s=>n.confirmPassword=s),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},$e=T(ye,[["__scopeId","data-v-edd74d0d"]]);export{$e as default};
