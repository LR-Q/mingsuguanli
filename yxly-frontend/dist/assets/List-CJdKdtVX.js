/* empty css                  *//* empty css                   *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     */import{aB as W,r as _,l as X,j as Y,z as Z,R as t,J as n,B,K as ee,O as u,A as b,I as h,P as E,L as w,u as te}from"./vendor-DSBWSuTS.js";import{k as ae,d as oe,e as ne,L as le,K as se,j as re,a5 as ce,a6 as ue,_ as ie,ak as de,a7 as me,n as pe,p as ge,a0 as fe,E as p,a as x}from"./elementPlus-fsp5CJhs.js";import{b as be,d as ke,e as _e,f as he,h as ve}from"./booking-Bi3Wmyaa.js";import{_ as ye}from"./index-rlk3mQiZ.js";const Ne={class:"booking-list"},Ce={class:"card-header"},Be={class:"search-area"},we={class:"pagination-wrapper"},xe={__name:"List",setup(Ve){const T=W(),V=_(!1),f=_(1),v=_(10),k=_(0),s=X({orderNumber:"",customerName:"",roomNumber:"",status:""}),y=_([]),z=a=>({pending:"待确认",confirmed:"已确认",checkedin:"已入住",checkedout:"已退房",cancelled:"被取消",cancelledByAdmin:"已取消"})[a]||a,A=a=>({pending:"warning",confirmed:"success",checkedin:"primary",checkedout:"info",cancelled:"danger",cancelledByAdmin:"danger"})[a]||"",I=()=>{T.push("/admin/bookings/create")},S=a=>{T.push(`/admin/bookings/${a.id}`)},P=async a=>{try{await x.confirm(`确定要确认订单 ${a.orderNumber} 吗？
确认后用户即可入住`,"确认订单",{confirmButtonText:"确定确认",cancelButtonText:"取消",type:"success"}),await ke(a.id),p.success("订单已确认"),await i()}catch(e){e!=="cancel"&&(console.error("确认订单失败:",e),p.error(e.message||"确认订单失败"))}},$=async a=>{try{await x.confirm(`确定要为订单 ${a.orderNumber} 办理入住吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await _e(a.id),p.success("办理入住成功"),i()}catch(e){e!=="cancel"&&p.error(e.message||"办理入住失败")}},D=async a=>{try{await x.confirm(`确定要为订单 ${a.orderNumber} 办理退房吗？
退房后订单状态将变为已完成`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await he(a.id),p.success("办理退房成功，订单已完成"),i()}catch(e){e!=="cancel"&&p.error(e.message||"办理退房失败")}},L=async a=>{try{const{value:e}=await x.prompt(`确定要取消订单 ${a.orderNumber} 吗？
取消后将自动退款至用户账户`,"取消订单",{confirmButtonText:"确定取消",cancelButtonText:"暂不取消",inputPlaceholder:"请输入取消原因（可选）",inputPattern:/.*/});await ve(a.id,e||"管理员取消"),p.success("订单已取消，已自动退款"),await i()}catch(e){e!=="cancel"&&(console.error("取消订单失败:",e),p.error(e.message||"取消订单失败"))}},M=()=>{f.value=1,i()},O=()=>{Object.assign(s,{orderNumber:"",customerName:"",roomNumber:"",status:""}),f.value=1,i()},U=a=>{v.value=a,i()},j=a=>{f.value=a,i()},i=async()=>{var a,e,N;V.value=!0;try{const l={page:f.value,size:v.value,orderNo:s.orderNumber,customerName:s.customerName,roomNumber:s.roomNumber,status:R(s.status)};console.log("请求参数:",l);const g=await be(l);console.log("API响应:",g);const d=g.data;if(!d){console.warn("响应数据为空"),y.value=[],k.value=0;return}const m=d.records||[];console.log("订单记录数:",m.length),y.value=m.map(r=>({id:r.id,orderNumber:r.orderNo,customerName:r.contactName||r.customerName||"-",customerPhone:r.contactPhone||"-",roomNumber:r.roomNumber||"-",checkInDate:r.checkInDate,checkOutDate:r.checkOutDate,nights:r.nights||0,totalAmount:r.totalAmount||0,status:F(r.bookingStatus),createTime:r.createTime})),k.value=d.total||0,console.log("加载完成，总记录数:",k.value)}catch(l){console.error("获取订单列表失败:",l),console.error("错误详情:",(a=l.response)==null?void 0:a.data);const g=((N=(e=l.response)==null?void 0:e.data)==null?void 0:N.message)||l.message||"获取订单列表失败";p.error(g),y.value=[],k.value=0}finally{V.value=!1}},F=a=>({1:"pending",2:"confirmed",3:"checkedin",4:"checkedout",5:"cancelled",6:"cancelledByAdmin"})[a]||"pending",R=a=>a&&{pending:1,confirmed:2,checkedin:3,checkedout:4,cancelled:5,cancelledByAdmin:6}[a]||"";return Y(()=>{i()}),(a,e)=>{const N=pe,l=re,g=ne,d=oe,m=se,r=le,K=ae,c=ue,J=ie,q=ce,G=me,H=fe,Q=de;return b(),Z("div",Ne,[t(H,{shadow:"never"},{header:n(()=>[B("div",Ce,[e[7]||(e[7]=B("h3",null,"订单管理",-1)),t(l,{type:"primary",onClick:I},{default:n(()=>[t(N,null,{default:n(()=>[t(te(ge))]),_:1}),e[6]||(e[6]=u(" 创建订单 ",-1))]),_:1})])]),default:n(()=>[B("div",Be,[t(K,{model:s,inline:""},{default:n(()=>[t(d,{label:"订单号"},{default:n(()=>[t(g,{modelValue:s.orderNumber,"onUpdate:modelValue":e[0]||(e[0]=o=>s.orderNumber=o),placeholder:"请输入订单号",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"客户姓名"},{default:n(()=>[t(g,{modelValue:s.customerName,"onUpdate:modelValue":e[1]||(e[1]=o=>s.customerName=o),placeholder:"请输入客户姓名",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"房间号"},{default:n(()=>[t(g,{modelValue:s.roomNumber,"onUpdate:modelValue":e[2]||(e[2]=o=>s.roomNumber=o),placeholder:"请输入房间号",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"订单状态"},{default:n(()=>[t(r,{modelValue:s.status,"onUpdate:modelValue":e[3]||(e[3]=o=>s.status=o),placeholder:"请选择状态",clearable:"",style:{width:"200px"}},{default:n(()=>[t(m,{label:"待确认",value:"pending"}),t(m,{label:"已确认",value:"confirmed"}),t(m,{label:"已入住",value:"checkedin"}),t(m,{label:"已退房",value:"checkedout"}),t(m,{label:"被取消（用户取消）",value:"cancelled"}),t(m,{label:"已取消（我取消的）",value:"cancelledByAdmin"})]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(l,{type:"primary",onClick:M},{default:n(()=>[...e[8]||(e[8]=[u("搜索",-1)])]),_:1}),t(l,{onClick:O},{default:n(()=>[...e[9]||(e[9]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),ee((b(),h(q,{data:y.value,style:{width:"100%"}},{default:n(()=>[t(c,{prop:"orderNumber",label:"订单号",width:"180"}),t(c,{prop:"customerName",label:"客户姓名",width:"120"}),t(c,{prop:"customerPhone",label:"联系电话",width:"130"}),t(c,{prop:"roomNumber",label:"房间号",width:"100"}),t(c,{prop:"checkInDate",label:"入住日期",width:"120"}),t(c,{prop:"checkOutDate",label:"退房日期",width:"120"}),t(c,{prop:"nights",label:"住宿天数",width:"100"},{default:n(({row:o})=>[u(E(o.nights)+"晚 ",1)]),_:1}),t(c,{prop:"totalAmount",label:"总金额",width:"120"},{default:n(({row:o})=>[u(" ¥"+E(o.totalAmount),1)]),_:1}),t(c,{prop:"status",label:"状态",width:"100"},{default:n(({row:o})=>[t(J,{type:A(o.status)},{default:n(()=>[u(E(z(o.status)),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"createTime",label:"创建时间",width:"160"}),t(c,{label:"操作",width:"300",fixed:"right"},{default:n(({row:o})=>[t(l,{type:"primary",size:"small",onClick:C=>S(o)},{default:n(()=>[...e[10]||(e[10]=[u(" 查看 ",-1)])]),_:1},8,["onClick"]),o.status==="pending"?(b(),h(l,{key:0,type:"success",size:"small",onClick:C=>P(o)},{default:n(()=>[...e[11]||(e[11]=[u(" 确认订单 ",-1)])]),_:1},8,["onClick"])):w("",!0),o.status==="confirmed"?(b(),h(l,{key:1,type:"success",size:"small",onClick:C=>$(o)},{default:n(()=>[...e[12]||(e[12]=[u(" 办理入住 ",-1)])]),_:1},8,["onClick"])):w("",!0),o.status==="checkedin"?(b(),h(l,{key:2,type:"warning",size:"small",onClick:C=>D(o)},{default:n(()=>[...e[13]||(e[13]=[u(" 办理退房 ",-1)])]),_:1},8,["onClick"])):w("",!0),o.status==="pending"||o.status==="confirmed"?(b(),h(l,{key:3,type:"danger",size:"small",onClick:C=>L(o)},{default:n(()=>[...e[14]||(e[14]=[u(" 取消订单 ",-1)])]),_:1},8,["onClick"])):w("",!0)]),_:1})]),_:1},8,["data"])),[[Q,V.value]]),B("div",we,[t(G,{"current-page":f.value,"onUpdate:currentPage":e[4]||(e[4]=o=>f.value=o),"page-size":v.value,"onUpdate:pageSize":e[5]||(e[5]=o=>v.value=o),"page-sizes":[10,20,50,100],total:k.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:U,onCurrentChange:j},null,8,["current-page","page-size","total"])])]),_:1})])}}},Ke=ye(xe,[["__scopeId","data-v-2528f26c"]]);export{Ke as default};
