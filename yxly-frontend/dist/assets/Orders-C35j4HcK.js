/* empty css                  *//* empty css                     *//* empty css                  */import{s as _e}from"./review-Bo7FEJ-k.js";/* empty css                  *//* empty css                   *//* empty css                             *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                             *//* empty css               *//* empty css                */import{Z as ve,a0 as fe,n as ge,M as he,V as ye,a9 as be,aa as ke,Y as we,j as Ce,e as Ve,O as Ee,P as xe,a7 as Se,ab as ze,ac as De,_ as Ie,S as Ne,k as Oe,d as Re,$ as Pe,ad as Te,E as g,R as Be,U as $e,T as Ue,a as qe}from"./elementPlus-fsp5CJhs.js";import{g as K,a as Ae}from"./booking-Bi3Wmyaa.js";import{_ as Fe}from"./index-rlk3mQiZ.js";import{r as p,l as Q,c as Le,j as Me,z as b,R as t,B as a,L as v,I as h,J as l,u as k,P as i,A as d,Q as Y,a6 as Z,O as u}from"./vendor-DSBWSuTS.js";const je={class:"orders-page"},Je={class:"stat-info"},Ke={class:"stat-icon pending"},Qe={class:"stat-content"},Ye={class:"stat-number"},Ze={class:"stat-info"},Ge={class:"stat-icon confirmed"},He={class:"stat-content"},We={class:"stat-number"},Xe={class:"stat-info"},et={class:"stat-icon completed"},tt={class:"stat-content"},at={class:"stat-number"},st={class:"stat-info"},lt={class:"stat-icon cancelled"},ot={class:"stat-content"},nt={class:"stat-number"},it={class:"order-filters"},ut={class:"filter-tabs"},rt={class:"filter-controls"},ct={class:"order-list"},dt={class:"order-header"},mt={class:"order-info"},pt={class:"order-number"},_t={class:"order-status"},vt={class:"order-content"},ft={class:"room-image"},gt={class:"image-slot"},ht={class:"order-details"},yt={class:"detail-row"},bt={class:"detail-row"},kt={class:"detail-row"},wt={class:"detail-row"},Ct={key:0,class:"detail-row"},Vt={class:"order-price"},Et={class:"price-info"},xt={class:"total-price"},St={class:"price-detail"},zt={class:"order-footer"},Dt={class:"order-time"},It={class:"order-actions"},Nt={key:0,class:"pagination-wrapper"},Ot={key:0,class:"order-detail-content"},Rt={__name:"Orders",setup(Pt){const w=p("all"),P=p(""),T=p([]),C=p(1),S=p(10),B=p(0),$=p(!1),N=p(!1),V=p(!1),r=p(null),U=p([]),f=Q({pending:0,confirmed:0,completed:0,cancelled:0}),G=[{label:"全部订单",value:"all"},{label:"待确认",value:1},{label:"已确认",value:2},{label:"已完成",value:4},{label:"已取消",value:5},{label:"被取消",value:6}],m=Q({rating:5,content:"",anonymous:!1}),O=Le(()=>U.value),z=o=>o.toFixed(2),D=o=>new Date(o).toLocaleDateString("zh-CN"),q=o=>new Date(o).toLocaleString("zh-CN"),A=o=>({1:"待确认",2:"已确认",3:"已入住",4:"已完成",5:"已取消",6:"被取消"})[o]||"未知",F=o=>({1:"warning",2:"primary",3:"info",4:"success",5:"danger",6:"danger"})[o]||"",H=o=>{S.value=o,E()},W=o=>{C.value=o,E()},X=async o=>{try{const{value:e}=await qe.prompt("请输入取消原因（可选）","取消订单",{confirmButtonText:"确定取消",cancelButtonText:"暂不取消",inputPattern:/.*/,inputPlaceholder:"请输入取消原因"});await Ae(o.id,e||"用户主动取消"),g.success("订单已取消"),E()}catch(e){e!=="cancel"&&g.error(e.message||"取消订单失败")}},L=o=>{r.value=o,N.value=!0},ee=o=>{r.value=o,V.value=!0,Object.assign(m,{rating:5,content:"",anonymous:!1})},te=o=>{g.info("退款正在处理中，请耐心等待")},ae=async()=>{var o,e;try{if(!m.content.trim()){g.error("请填写评价内容");return}await _e({roomId:(o=r.value)==null?void 0:o.roomId,orderId:(e=r.value)==null?void 0:e.id,rating:m.rating,content:m.content,anonymous:m.anonymous}),g.success("评价提交成功"),V.value=!1}catch{g.error("评价提交失败，请重试")}},E=async()=>{try{$.value=!0;const o={current:C.value,size:S.value};w.value!=="all"&&(o.status=w.value);const e=await K(o);e.data&&e.data.records&&(U.value=e.data.records.map(n=>({id:n.id,roomId:n.roomId,orderNumber:n.orderNo,roomName:n.roomName||"房间",roomType:n.roomType||"",roomImage:"/api/placeholder/300/200",roomPrice:n.roomPrice,checkInDate:n.checkInDate,checkOutDate:n.checkOutDate,nights:n.nights,guests:n.guestsCount,contactName:n.contactName,contactPhone:n.contactPhone,specialRequests:n.specialRequests,totalAmount:n.totalAmount,status:n.bookingStatus,createTime:n.createTime,cancelReason:n.cancelReason,cancelTime:n.cancelTime})),B.value=e.data.total,se())}catch(o){console.error("加载订单失败:",o),g.error("加载订单失败，请重试")}finally{$.value=!1}},se=async()=>{try{const o=await K({current:1,size:1e3});if(o.data&&o.data.records){const e=o.data.records;f.pending=e.filter(n=>n.bookingStatus===1).length,f.confirmed=e.filter(n=>n.bookingStatus===2).length,f.completed=e.filter(n=>n.bookingStatus===4).length,f.cancelled=e.filter(n=>n.bookingStatus===5||n.bookingStatus===6).length}}catch(o){console.error("更新统计失败:",o)}},le=o=>{w.value=o,C.value=1,E()};return Me(()=>{E()}),(o,e)=>{const n=ge,y=fe,I=ve,oe=we,_=Ce,M=Ve,ne=xe,j=Ie,ie=$e,ue=Se,re=Be,c=De,ce=ze,J=Ne,de=Pe,R=Re,me=Te,pe=Oe;return d(),b("div",je,[t(oe,{gutter:20,class:"order-stats"},{default:l(()=>[t(I,{span:6},{default:l(()=>[t(y,{class:"stat-card",shadow:"never"},{default:l(()=>[a("div",Je,[a("div",Ke,[t(n,null,{default:l(()=>[t(k(he))]),_:1})]),a("div",Qe,[e[11]||(e[11]=a("h3",null,"待确认",-1)),a("p",Ye,i(f.pending),1)])])]),_:1})]),_:1}),t(I,{span:6},{default:l(()=>[t(y,{class:"stat-card",shadow:"never"},{default:l(()=>[a("div",Ze,[a("div",Ge,[t(n,null,{default:l(()=>[t(k(ye))]),_:1})]),a("div",He,[e[12]||(e[12]=a("h3",null,"已确认",-1)),a("p",We,i(f.confirmed),1)])])]),_:1})]),_:1}),t(I,{span:6},{default:l(()=>[t(y,{class:"stat-card",shadow:"never"},{default:l(()=>[a("div",Xe,[a("div",et,[t(n,null,{default:l(()=>[t(k(be))]),_:1})]),a("div",tt,[e[13]||(e[13]=a("h3",null,"已完成",-1)),a("p",at,i(f.completed),1)])])]),_:1})]),_:1}),t(I,{span:6},{default:l(()=>[t(y,{class:"stat-card",shadow:"never"},{default:l(()=>[a("div",st,[a("div",lt,[t(n,null,{default:l(()=>[t(k(ke))]),_:1})]),a("div",ot,[e[14]||(e[14]=a("h3",null,"已取消",-1)),a("p",nt,i(f.cancelled),1)])])]),_:1})]),_:1})]),_:1}),t(y,{class:"filter-card",shadow:"never"},{default:l(()=>[a("div",it,[a("div",ut,[(d(),b(Y,null,Z(G,s=>t(_,{key:s.value,type:w.value===s.value?"primary":"",plain:w.value!==s.value,onClick:x=>le(s.value)},{default:l(()=>[u(i(s.label),1)]),_:2},1032,["type","plain","onClick"])),64))]),a("div",rt,[t(M,{modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=s=>P.value=s),placeholder:"搜索订单号或房间名称",style:{width:"200px"},clearable:""},{prefix:l(()=>[t(n,null,{default:l(()=>[t(k(Ee))]),_:1})]),_:1},8,["modelValue"]),t(ne,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=s=>T.value=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px","margin-left":"12px"}},null,8,["modelValue"])])])]),_:1}),a("div",ct,[(d(!0),b(Y,null,Z(O.value,s=>(d(),h(y,{key:s.id,class:"order-item",shadow:"never"},{default:l(()=>[a("div",dt,[a("div",mt,[a("h3",null,i(s.roomName),1),a("p",pt,"订单号："+i(s.orderNumber),1)]),a("div",_t,[t(j,{type:F(s.status),size:"large"},{default:l(()=>[u(i(A(s.status)),1)]),_:2},1032,["type"])])]),a("div",vt,[a("div",ft,[t(ie,{src:s.roomImage,fit:"cover",style:{width:"120px",height:"90px","border-radius":"6px"}},{error:l(()=>[a("div",gt,[t(n,null,{default:l(()=>[t(k(Ue))]),_:1})])]),_:1},8,["src"])]),a("div",ht,[a("div",yt,[e[15]||(e[15]=a("span",{class:"label"},"入住时间：",-1)),a("span",null,i(D(s.checkInDate))+" - "+i(D(s.checkOutDate)),1)]),a("div",bt,[e[16]||(e[16]=a("span",{class:"label"},"入住天数：",-1)),a("span",null,i(s.nights)+"晚",1)]),a("div",kt,[e[17]||(e[17]=a("span",{class:"label"},"入住人数：",-1)),a("span",null,i(s.guests)+"人",1)]),a("div",wt,[e[18]||(e[18]=a("span",{class:"label"},"联系电话：",-1)),a("span",null,i(s.contactPhone),1)]),s.specialRequests?(d(),b("div",Ct,[e[19]||(e[19]=a("span",{class:"label"},"特殊要求：",-1)),a("span",null,i(s.specialRequests),1)])):v("",!0)]),a("div",Vt,[a("div",Et,[a("p",xt,"¥"+i(z(s.totalAmount)),1),a("p",St,i(s.nights)+"晚 × ¥"+i(z(s.roomPrice))+"/晚",1)])])]),a("div",zt,[a("div",Dt,[a("span",null,"下单时间："+i(q(s.createTime)),1)]),a("div",It,[s.status===1?(d(),h(_,{key:0,type:"danger",plain:"",size:"small",onClick:x=>X(s)},{default:l(()=>[...e[20]||(e[20]=[u(" 取消订单 ",-1)])]),_:1},8,["onClick"])):v("",!0),s.status===2?(d(),h(_,{key:1,type:"primary",plain:"",size:"small",onClick:x=>L(s)},{default:l(()=>[...e[21]||(e[21]=[u(" 查看详情 ",-1)])]),_:1},8,["onClick"])):v("",!0),s.status===4?(d(),h(_,{key:2,type:"success",plain:"",size:"small",onClick:x=>ee(s)},{default:l(()=>[...e[22]||(e[22]=[u(" 评价订单 ",-1)])]),_:1},8,["onClick"])):v("",!0),s.status===5&&s.refundStatus==="pending"?(d(),h(_,{key:3,type:"warning",plain:"",size:"small",onClick:x=>te(s)},{default:l(()=>[...e[23]||(e[23]=[u(" 查看退款 ",-1)])]),_:1},8,["onClick"])):v("",!0),t(_,{size:"small",onClick:x=>L(s)},{default:l(()=>[...e[24]||(e[24]=[u(" 订单详情 ",-1)])]),_:1},8,["onClick"])])])]),_:2},1024))),128))]),O.value.length>0?(d(),b("div",Nt,[t(ue,{"current-page":C.value,"onUpdate:currentPage":e[2]||(e[2]=s=>C.value=s),"page-size":S.value,"onUpdate:pageSize":e[3]||(e[3]=s=>S.value=s),"page-sizes":[5,10,20],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:W},null,8,["current-page","page-size","total"])])):v("",!0),O.value.length===0?(d(),h(re,{key:1,description:"暂无订单记录","image-size":200},{default:l(()=>[t(_,{type:"primary",onClick:e[4]||(e[4]=s=>o.$router.push("/rooms"))},{default:l(()=>[...e[25]||(e[25]=[u(" 去预订房间 ",-1)])]),_:1})]),_:1})):v("",!0),t(J,{modelValue:N.value,"onUpdate:modelValue":e[5]||(e[5]=s=>N.value=s),title:"订单详情",width:"600px"},{default:l(()=>[r.value?(d(),b("div",Ot,[t(ce,{column:2,border:""},{default:l(()=>[t(c,{label:"订单号"},{default:l(()=>[u(i(r.value.orderNumber),1)]),_:1}),t(c,{label:"订单状态"},{default:l(()=>[t(j,{type:F(r.value.status)},{default:l(()=>[u(i(A(r.value.status)),1)]),_:1},8,["type"])]),_:1}),t(c,{label:"房间名称"},{default:l(()=>[u(i(r.value.roomName),1)]),_:1}),t(c,{label:"房间类型"},{default:l(()=>[u(i(r.value.roomType),1)]),_:1}),t(c,{label:"入住日期"},{default:l(()=>[u(i(D(r.value.checkInDate)),1)]),_:1}),t(c,{label:"退房日期"},{default:l(()=>[u(i(D(r.value.checkOutDate)),1)]),_:1}),t(c,{label:"入住天数"},{default:l(()=>[u(i(r.value.nights)+"晚",1)]),_:1}),t(c,{label:"入住人数"},{default:l(()=>[u(i(r.value.guests)+"人",1)]),_:1}),t(c,{label:"联系人"},{default:l(()=>[u(i(r.value.contactName),1)]),_:1}),t(c,{label:"联系电话"},{default:l(()=>[u(i(r.value.contactPhone),1)]),_:1}),t(c,{label:"房间单价"},{default:l(()=>[u("¥"+i(z(r.value.roomPrice))+"/晚",1)]),_:1}),t(c,{label:"订单总额"},{default:l(()=>[u("¥"+i(z(r.value.totalAmount)),1)]),_:1}),t(c,{label:"下单时间",span:2},{default:l(()=>[u(i(q(r.value.createTime)),1)]),_:1}),r.value.specialRequests?(d(),h(c,{key:0,label:"特殊要求",span:2},{default:l(()=>[u(i(r.value.specialRequests),1)]),_:1})):v("",!0)]),_:1})])):v("",!0)]),_:1},8,["modelValue"]),t(J,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=s=>V.value=s),title:"订单评价",width:"500px"},{footer:l(()=>[t(_,{onClick:e[9]||(e[9]=s=>V.value=!1)},{default:l(()=>[...e[26]||(e[26]=[u("取消",-1)])]),_:1}),t(_,{type:"primary",onClick:ae},{default:l(()=>[...e[27]||(e[27]=[u("提交评价",-1)])]),_:1})]),default:l(()=>[t(pe,{model:m,"label-width":"80px"},{default:l(()=>[t(R,{label:"评分"},{default:l(()=>[t(de,{modelValue:m.rating,"onUpdate:modelValue":e[6]||(e[6]=s=>m.rating=s),max:5,"show-text":""},null,8,["modelValue"])]),_:1}),t(R,{label:"评价内容"},{default:l(()=>[t(M,{modelValue:m.content,"onUpdate:modelValue":e[7]||(e[7]=s=>m.content=s),type:"textarea",rows:4,placeholder:"请分享您的入住体验..."},null,8,["modelValue"])]),_:1}),t(R,{label:"是否匿名"},{default:l(()=>[t(me,{modelValue:m.anonymous,"onUpdate:modelValue":e[8]||(e[8]=s=>m.anonymous=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},aa=Fe(Rt,[["__scopeId","data-v-ad632eb0"]]);export{aa as default};
