/* empty css                  *//* empty css                  *//* empty css                   *//* empty css                        *//* empty css                 *//* empty css                         *//* empty css                             *//* empty css                 *//* empty css                     *//* empty css               *//* empty css                  */import{aB as ae,aE as le,r as f,c as oe,l as ne,w as z,j as ie,z as u,B as l,R as i,J as d,O as v,u as y,A as r,Q as b,a6 as T,I as D,L as w,P as m}from"./vendor-DSBWSuTS.js";import{n as ce,O as re,j as ue,K as de,L as me,P as fe,Q as pe,R as ve,S as he,E as k,T as U,U as _e,F as ge,V as ye,v as ke,W as Ie}from"./elementPlus-fsp5CJhs.js";import{g as be,a as Te,b as we,s as Oe}from"./userRoom-DRSYUXnR.js";import{c as Ne}from"./favorite-BYD8vYC-.js";import{_ as Ve}from"./index-rlk3mQiZ.js";const Re={class:"user-rooms"},Ce={class:"container"},Ee={class:"search-section"},xe={class:"hero"},Se={class:"hero-inner"},De={class:"hero-title"},Le={class:"title-action"},Pe={class:"search-bar"},$e={class:"field"},Ae={class:"field"},Fe={class:"control-row"},Me={key:0,class:"nights-inline"},ze={class:"field"},Ue={class:"field"},Be={class:"rooms-section"},Ge={key:0,class:"loading-container"},Je={key:1,class:"empty-container"},qe={key:2,class:"rooms-grid"},Ye={class:"image-placeholder"},je={key:1,class:"image-placeholder"},Qe={class:"room-content"},He={class:"room-info"},Ke={key:0,class:"room-location"},We={class:"room-desc"},Xe={key:1,class:"room-features"},Ze={class:"feature-list"},es={key:0,class:"more-features"},ss={class:"room-details"},ts={class:"group-count"},as={class:"room-actions"},ls={class:"price-info"},os={class:"price"},ns={class:"action-buttons"},is={key:3,class:"load-more"},cs={key:0},rs={key:1,class:"select-rooms"},us={class:"left"},ds={class:"title"},ms={class:"meta"},fs={class:"right"},ps={class:"price"},vs={__name:"Rooms",setup(hs){const B=ae(),C=le(),I=f(!1),E=f(!0),p=f([]),G=oe(()=>{const o=new Map;return p.value.forEach(e=>{const c=`${e.locationId||""}-${e.roomTypeId||""}`;if(!o.has(c))o.set(c,{key:c,locationId:e.locationId,locationName:e.locationName,roomTypeId:e.roomTypeId,roomTypeName:e.roomTypeName||e.name||"房型",description:e.description,facilities:Array.isArray(e.facilities)?[...e.facilities]:[],area:e.area,bedType:e.bedType,maxGuests:e.maxGuests,minPrice:e.price,coverImage:e.currentImage,rooms:[e]});else{const s=o.get(c);s.minPrice=Math.min(s.minPrice??e.price,e.price);const t=new Set([...s.facilities||[],...Array.isArray(e.facilities)?e.facilities:[]]);s.facilities=Array.from(t),!s.coverImage&&e.currentImage&&(s.coverImage=e.currentImage),s.rooms.push(e)}}),Array.from(o.values())}),L=f([]),P=f([]),O=f(0),N=f(1),$=f(6),n=ne({locationId:null,checkIn:C.query.checkIn||"",checkOut:C.query.checkOut||"",guests:C.query.guests||null,roomTypeId:null}),_=f(n.checkIn&&n.checkOut?[n.checkIn,n.checkOut]:null),V=f(0),x=async(o=!1)=>{try{I.value=!0;const e={current:o?N.value+1:1,size:$.value,locationId:n.locationId||null,roomTypeId:n.roomTypeId||null},s=(await we(e)).data;o?(p.value.push(...s.records),N.value=s.current):(p.value=s.records,N.value=1),O.value=s.total,E.value=s.current<s.pages,p.value.forEach(t=>{if(t.facilities&&typeof t.facilities=="string")try{t.facilities=JSON.parse(t.facilities)}catch{t.facilities=[]}if(t.images&&typeof t.images=="string")try{const h=JSON.parse(t.images);t.imageList=h,t.currentImageIndex=0,t.currentImage=h.length>0?h[0]:null,t.showControls=!1}catch{t.imageList=[],t.currentImageIndex=0,t.currentImage=null,t.showControls=!1}else t.imageList=[],t.currentImageIndex=0,t.currentImage=null,t.showControls=!1;t.name=t.roomTypeName||`${t.roomNumber}号房间`,t.price=t.currentPrice||t.basePrice||0,t.isFavorite=!1,t.favoriteLoading=!1}),await F()}catch(e){console.error("加载房间列表失败:",e),k.error("加载房间列表失败")}finally{I.value=!1}},J=async()=>{try{const o=await Te();L.value=o.data}catch(o){console.error("加载房型列表失败:",o)}},q=async()=>{try{const o=await be();P.value=o.data||[]}catch(o){console.error("加载民宿位置列表失败:",o)}},Y=()=>{if(n.checkIn&&n.checkOut){const o=new Date(n.checkIn).getTime();if(new Date(n.checkOut).getTime()<=o)return k.error("退房日期必须晚于入住日期"),!1}return!n.checkIn&&n.checkOut?(k.error("请先选择入住日期"),!1):!0},j=async()=>{if(M(),!!Y())try{I.value=!0;const o={current:1,size:$.value,locationId:n.locationId||null,checkIn:n.checkIn||null,checkOut:n.checkOut||null,guests:n.guests||null,roomTypeId:n.roomTypeId||null},c=(await Oe(o)).data;p.value=c.records,O.value=c.total,N.value=1,E.value=c.current<c.pages,p.value.forEach(s=>{if(s.facilities&&typeof s.facilities=="string")try{s.facilities=JSON.parse(s.facilities)}catch{s.facilities=[]}if(s.images&&typeof s.images=="string")try{const t=JSON.parse(s.images);s.imageList=t,s.currentImageIndex=0,s.currentImage=t.length>0?t[0]:null,s.showControls=!1}catch{s.imageList=[],s.currentImageIndex=0,s.currentImage=null,s.showControls=!1}else s.imageList=[],s.currentImageIndex=0,s.currentImage=null,s.showControls=!1;s.name=s.roomTypeName||`${s.roomNumber}号房间`,s.price=s.currentPrice||s.basePrice||0,s.isFavorite=!1,s.favoriteLoading=!1}),await F(),O.value===0?k.info("未找到符合条件的房间"):k.success(`找到 ${O.value} 间符合条件的房间`)}catch(o){console.error("搜索房间失败:",o),k.error("搜索房间失败")}finally{I.value=!1}},A=o=>{if(!o.rooms||o.rooms.length===0)return;const e=[...o.rooms].sort((c,s)=>(c.price||0)-(s.price||0))[0];B.push({path:`/rooms/${e.id}/book`,query:{checkIn:n.checkIn,checkOut:n.checkOut,guests:n.guests}})},R=f(!1),S=f([]),Q=o=>{S.value=o.rooms||[],R.value=!0},H=o=>{R.value=!1,A({rooms:[o]})},K=o=>{const e=new Date;return e.setHours(0,0,0,0),o.getTime()<e.getTime()},W=()=>{x(!0)};z(()=>n.checkIn,o=>{if(o&&n.checkOut){const e=new Date(o).getTime();new Date(n.checkOut).getTime()<=e&&(n.checkOut="",k.warning("退房日期必须晚于入住日期，已自动清空退房日期"))}});const F=async()=>{if(p.value.length!==0)try{const o=p.value.map(c=>c.id),e=await Ne(o);e.data&&typeof e.data=="object"&&p.value.forEach(c=>{c.isFavorite=e.data[c.id]||!1})}catch(o){console.error("检查收藏状态失败:",o)}};ie(()=>{q(),J(),x()});const M=()=>{_.value&&_.value.length===2?(n.checkIn=_.value[0],n.checkOut=_.value[1]):(n.checkIn="",n.checkOut="")};return z(_,o=>{if(M(),n.checkIn&&n.checkOut){const e=new Date(n.checkIn).getTime(),s=(new Date(n.checkOut).getTime()-e)/(1e3*60*60*24);V.value=s>0?s:0}else V.value=0}),(o,e)=>{const c=ce,s=ue,t=de,h=me,X=fe,Z=pe,ee=ve,se=_e,te=he;return r(),u("div",Re,[l("div",Ce,[l("div",Ee,[l("div",xe,[l("div",Se,[l("div",De,[e[8]||(e[8]=l("div",{class:"title-left"},[l("h2",null,"房间预订"),l("p",null,"选择您的目的地与日期，开始一次舒适的入住")],-1)),l("div",Le,[i(s,{class:"hero-search-btn",type:"primary",onClick:j},{default:d(()=>[i(c,{style:{"margin-right":"8px"}},{default:d(()=>[i(y(re))]),_:1}),e[7]||(e[7]=v(" 搜索 ",-1))]),_:1})])]),l("div",Pe,[l("div",$e,[e[9]||(e[9]=l("div",{class:"label"},"民宿位置",-1)),i(h,{modelValue:n.locationId,"onUpdate:modelValue":e[0]||(e[0]=a=>n.locationId=a),placeholder:"全部民宿",clearable:"",filterable:"",class:"w-240"},{default:d(()=>[(r(!0),u(b,null,T(P.value,a=>(r(),D(t,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),l("div",Ae,[e[10]||(e[10]=l("div",{class:"label"},"入住/退房",-1)),l("div",Fe,[i(X,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=a=>_.value=a),type:"daterange","range-separator":"-","start-placeholder":"选择入住日期","end-placeholder":"选择退房日期","value-format":"YYYY-MM-DD","disabled-date":K,class:"w-full"},null,8,["modelValue"]),V.value>0?(r(),u("span",Me,m(V.value)+" 晚",1)):w("",!0)])]),l("div",ze,[e[11]||(e[11]=l("div",{class:"label"},"入住人数",-1)),i(h,{modelValue:n.guests,"onUpdate:modelValue":e[2]||(e[2]=a=>n.guests=a),placeholder:"选择人数（可选）",clearable:"",class:"w-160"},{default:d(()=>[i(t,{label:"1人",value:1}),i(t,{label:"2人",value:2}),i(t,{label:"3人",value:3}),i(t,{label:"4人",value:4}),i(t,{label:"5人以上",value:5})]),_:1},8,["modelValue"])]),l("div",Ue,[e[12]||(e[12]=l("div",{class:"label"},"房型",-1)),i(h,{modelValue:n.roomTypeId,"onUpdate:modelValue":e[3]||(e[3]=a=>n.roomTypeId=a),placeholder:"选择房型",clearable:"",class:"w-200"},{default:d(()=>[i(t,{label:"所有房型",value:null}),(r(!0),u(b,null,T(L.value,a=>(r(),D(t,{key:a.id,label:a.typeName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])])])]),l("div",Be,[I.value&&p.value.length===0?(r(),u("div",Ge,[i(Z,{rows:3,animated:""})])):p.value.length===0?(r(),u("div",Je,[i(ee,{description:"暂无可用房间"},{default:d(()=>[i(s,{type:"primary",onClick:x},{default:d(()=>[...e[13]||(e[13]=[v("重新加载",-1)])]),_:1})]),_:1})])):(r(),u("div",qe,[(r(!0),u(b,null,T(G.value,a=>(r(),u("div",{key:a.key,class:"room-card"},[l("div",{class:"room-image",onMouseenter:e[4]||(e[4]=g=>o.room.showControls=!0),onMouseleave:e[5]||(e[5]=g=>o.room.showControls=!1)},[a.coverImage?(r(),D(se,{key:0,src:a.coverImage,fit:"cover",class:"room-img"},{error:d(()=>[l("div",Ye,[i(c,{size:"60"},{default:d(()=>[i(y(U))]),_:1}),e[14]||(e[14]=l("p",null,"房间图片",-1))])]),_:1},8,["src"])):(r(),u("div",je,[i(c,{size:"60"},{default:d(()=>[i(y(U))]),_:1}),e[15]||(e[15]=l("p",null,"房间图片",-1))]))],32),l("div",Qe,[l("div",He,[l("h3",null,m(a.roomTypeName),1),a.locationName?(r(),u("p",Ke,[i(c,null,{default:d(()=>[i(y(ge))]),_:1}),v(" "+m(a.locationName),1)])):w("",!0),l("p",We,m(a.description||"舒适温馨的房间，为您提供优质的住宿体验"),1),a.facilities&&a.facilities.length>0?(r(),u("div",Xe,[l("div",Ze,[(r(!0),u(b,null,T(a.facilities.slice(0,6),g=>(r(),u("span",{key:g,class:"feature-item"},[i(c,{class:"feature-icon"},{default:d(()=>[i(y(ye))]),_:1}),v(" "+m(g),1)]))),128)),a.facilities.length>6?(r(),u("span",es," +"+m(a.facilities.length-6)+"项设施 ",1)):w("",!0)])])):w("",!0),l("div",ss,[l("span",null,[i(c,null,{default:d(()=>[i(y(ke))]),_:1}),v(" 最多"+m(a.maxGuests)+"人",1)]),l("span",null,[i(c,null,{default:d(()=>[i(y(Ie))]),_:1}),v(" "+m(a.area)+"㎡",1)]),l("span",null,m(a.bedType||"标准床型"),1),l("span",ts,"剩余"+m(a.rooms.length)+"间",1)])]),l("div",as,[l("div",ls,[l("span",os,"￥"+m(a.minPrice),1),e[16]||(e[16]=l("span",{class:"unit"},"/晚",-1))]),l("div",ns,[i(s,{type:"primary",size:"large",onClick:g=>A(a)},{default:d(()=>[...e[17]||(e[17]=[v("立即预订",-1)])]),_:1},8,["onClick"]),i(s,{size:"large",onClick:g=>Q(a)},{default:d(()=>[...e[18]||(e[18]=[v("选择具体房间",-1)])]),_:1},8,["onClick"])])])])]))),128))])),E.value?(r(),u("div",is,[i(s,{onClick:W,loading:I.value},{default:d(()=>[...e[19]||(e[19]=[v("加载更多",-1)])]),_:1},8,["loading"])])):w("",!0)]),i(te,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=a=>R.value=a),title:"选择具体房间",width:"600px"},{default:d(()=>[S.value.length===0?(r(),u("div",cs,"暂无可选房间")):(r(),u("div",rs,[(r(!0),u(b,null,T(S.value,a=>(r(),u("div",{class:"select-room-item",key:a.id},[l("div",us,[l("div",ds,"房间 "+m(a.roomNumber),1),l("div",ms,"最多"+m(a.maxGuests)+"人 · "+m(a.area)+"㎡ · "+m(a.bedType||"床型"),1)]),l("div",fs,[l("span",ps,"￥"+m(a.price),1),i(s,{type:"primary",size:"small",onClick:g=>H(a),style:{"margin-left":"8px"}},{default:d(()=>[...e[20]||(e[20]=[v("预订",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1},8,["modelValue"])])])}}},Ds=Ve(vs,[["__scopeId","data-v-145734fc"]]);export{Ds as default};
