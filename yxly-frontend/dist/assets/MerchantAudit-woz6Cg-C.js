/* empty css                  *//* empty css                   *//* empty css                             *//* empty css                 *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                     *//* empty css                  *//* empty css                */import{g as Z,a as q,r as J}from"./superAdmin-CPV5vgik.js";import{a0 as G,k as Q,d as W,L as X,K as ee,j as ae,a5 as le,a6 as te,U as se,_ as re,ak as oe,e as ne,S as ue,o as ie,ab as de,ac as pe,E as y,al as me,a as fe}from"./elementPlus-fsp5CJhs.js";import{_ as ve}from"./index-rlk3mQiZ.js";import{r as v,j as ce,z as _e,R as l,J as a,B as d,O as r,K as ge,A as n,I as u,L as c,P as i}from"./vendor-DSBWSuTS.js";const we={class:"merchant-audit-container"},ye={class:"id-card-preview"},be={style:{display:"flex",gap:"8px","justify-content":"center","flex-wrap":"wrap"}},ke={__name:"MerchantAudit",setup(Ce){const z=v(!1),b=v(!1),T=v([]),D=v(null),C=v(!1),I=v(!1),x=v(!1),s=v(null),p=v({merchantId:null,auditStatus:null,auditRemarks:""}),_=v({merchantId:null,newPassword:"merchant123"}),V=async()=>{z.value=!0;try{const o=await Z(D.value);T.value=o.data||[]}catch(o){console.error("加载商户列表失败:",o),y.error(o.message||"加载失败")}finally{z.value=!1}},F=(o,e)=>{s.value=o,p.value={merchantId:o.id,auditStatus:e,auditRemarks:""},C.value=!0},N=async()=>{if(p.value.auditStatus===2&&!p.value.auditRemarks){y.warning("请填写拒绝原因");return}b.value=!0;try{await q(p.value),y.success("审核成功"),C.value=!1,V()}catch(o){console.error("审核失败:",o),y.error(o.message||"审核失败")}finally{b.value=!1}},$=o=>{s.value=o,I.value=!0},U=o=>{s.value=o,_.value={merchantId:o.id,newPassword:"merchant123"},x.value=!0},L=async()=>{if(!_.value.newPassword){y.warning("请输入新密码");return}if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{6,20}$/.test(_.value.newPassword)){y.warning("密码格式不正确，需要6-20位且包含字母和数字");return}b.value=!0;try{await J(_.value),y.success("密码重置成功"),x.value=!1,fe.alert(`新密码：${_.value.newPassword}

请及时通知商户并建议其登录后立即修改密码。`,"重置成功",{confirmButtonText:"我已复制密码",type:"success",dangerouslyUseHTMLString:!1})}catch(e){console.error("重置密码失败:",e),y.error(e.message||"重置密码失败")}finally{b.value=!1}},h=o=>o?me(o).format("YYYY-MM-DD HH:mm:ss"):"-";return ce(()=>{V()}),(o,e)=>{const B=G,E=ee,j=X,m=W,g=ae,M=Q,w=te,S=se,k=re,Y=le,A=ne,P=ue,H=ie,f=pe,K=de,O=oe;return n(),_e("div",we,[l(B,{class:"header-card"},{default:a(()=>[...e[8]||(e[8]=[d("h2",null,"商户审核管理",-1),d("p",null,"审核民宿主管理员的注册申请",-1)])]),_:1}),l(B,{class:"filter-card"},{default:a(()=>[l(M,{inline:!0},{default:a(()=>[l(m,{label:"审核状态"},{default:a(()=>[l(j,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=t=>D.value=t),placeholder:"全部",size:"large",onChange:V,style:{width:"150px"}},{default:a(()=>[l(E,{label:"全部",value:null}),l(E,{label:"待审核",value:0}),l(E,{label:"已通过",value:1}),l(E,{label:"已拒绝",value:2})]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:a(()=>[l(g,{type:"primary",size:"large",onClick:V},{default:a(()=>[...e[9]||(e[9]=[r("查询",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(B,{class:"table-card"},{default:a(()=>[ge((n(),u(Y,{data:T.value,border:""},{default:a(()=>[l(w,{prop:"id",label:"商户ID",width:"80"}),l(w,{prop:"username",label:"用户名",width:"120"}),l(w,{prop:"realName",label:"真实姓名",width:"100"}),l(w,{prop:"phone",label:"手机号",width:"120"}),l(w,{label:"身份证照片",width:"180"},{default:a(({row:t})=>[d("div",ye,[t.idCardFront?(n(),u(S,{key:0,src:t.idCardFront,"preview-src-list":[t.idCardFront],style:{width:"60px",height:"40px","margin-right":"5px",cursor:"pointer"},fit:"cover"},{error:a(()=>[...e[10]||(e[10]=[d("div",{class:"image-error"},"正面",-1)])]),_:1},8,["src","preview-src-list"])):c("",!0),t.idCardBack?(n(),u(S,{key:1,src:t.idCardBack,"preview-src-list":[t.idCardBack],style:{width:"60px",height:"40px",cursor:"pointer"},fit:"cover"},{error:a(()=>[...e[11]||(e[11]=[d("div",{class:"image-error"},"反面",-1)])]),_:1},8,["src","preview-src-list"])):c("",!0)])]),_:1}),l(w,{label:"审核状态",width:"140",align:"center"},{default:a(({row:t})=>[t.auditStatus===0?(n(),u(k,{key:0,type:"warning",size:"large",effect:"plain"},{default:a(()=>[...e[12]||(e[12]=[r("待审核",-1)])]),_:1})):t.auditStatus===1?(n(),u(k,{key:1,type:"success",size:"large",effect:"plain"},{default:a(()=>[...e[13]||(e[13]=[r("已通过",-1)])]),_:1})):t.auditStatus===2?(n(),u(k,{key:2,type:"danger",size:"large",effect:"plain"},{default:a(()=>[...e[14]||(e[14]=[r("已拒绝",-1)])]),_:1})):c("",!0)]),_:1}),l(w,{prop:"createTime",label:"申请时间",width:"160"},{default:a(({row:t})=>[r(i(h(t.createTime)),1)]),_:1}),l(w,{prop:"auditRemarks",label:"审核备注","min-width":"150","show-overflow-tooltip":""}),l(w,{label:"操作",width:"250",fixed:"right"},{default:a(({row:t})=>[d("div",be,[l(g,{size:"small",onClick:R=>$(t)},{default:a(()=>[...e[15]||(e[15]=[r(" 详情 ",-1)])]),_:1},8,["onClick"]),t.auditStatus===0?(n(),u(g,{key:0,type:"success",size:"small",onClick:R=>F(t,1)},{default:a(()=>[...e[16]||(e[16]=[r(" 通过 ",-1)])]),_:1},8,["onClick"])):c("",!0),t.auditStatus===0?(n(),u(g,{key:1,type:"danger",size:"small",onClick:R=>F(t,2)},{default:a(()=>[...e[17]||(e[17]=[r(" 拒绝 ",-1)])]),_:1},8,["onClick"])):c("",!0),t.auditStatus===1?(n(),u(g,{key:2,type:"warning",size:"small",onClick:R=>U(t)},{default:a(()=>[...e[18]||(e[18]=[r(" 重置密码 ",-1)])]),_:1},8,["onClick"])):c("",!0)])]),_:1})]),_:1},8,["data"])),[[O,z.value]])]),_:1}),l(P,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=t=>C.value=t),title:p.value.auditStatus===1?"审核通过":"审核拒绝",width:"500px"},{footer:a(()=>[l(g,{onClick:e[2]||(e[2]=t=>C.value=!1)},{default:a(()=>[...e[19]||(e[19]=[r("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:N,loading:b.value},{default:a(()=>[...e[20]||(e[20]=[r(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(M,{model:p.value,"label-width":"100px"},{default:a(()=>[l(m,{label:"商户ID"},{default:a(()=>[d("span",null,i(p.value.merchantId),1)]),_:1}),l(m,{label:"真实姓名"},{default:a(()=>{var t;return[d("span",null,i((t=s.value)==null?void 0:t.realName),1)]}),_:1}),l(m,{label:"审核备注"},{default:a(()=>[l(A,{modelValue:p.value.auditRemarks,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value.auditRemarks=t),type:"textarea",rows:4,placeholder:p.value.auditStatus===1?"请填写审核通过的备注（可选）":"请填写拒绝原因"},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(P,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=t=>x.value=t),title:"重置商户密码",width:"500px"},{footer:a(()=>[l(g,{onClick:e[5]||(e[5]=t=>x.value=!1)},{default:a(()=>[...e[22]||(e[22]=[r("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:L,loading:b.value},{default:a(()=>[...e[23]||(e[23]=[r(" 确认重置 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(M,{model:_.value,"label-width":"100px"},{default:a(()=>[l(m,{label:"商户ID"},{default:a(()=>[d("span",null,i(_.value.merchantId),1)]),_:1}),l(m,{label:"商户名称"},{default:a(()=>{var t;return[d("span",null,i((t=s.value)==null?void 0:t.merchantName),1)]}),_:1}),l(m,{label:"真实姓名"},{default:a(()=>{var t;return[d("span",null,i((t=s.value)==null?void 0:t.realName),1)]}),_:1}),l(m,{label:"用户名"},{default:a(()=>{var t;return[d("span",null,i((t=s.value)==null?void 0:t.username),1)]}),_:1}),l(m,{label:"新密码",required:""},{default:a(()=>[l(A,{modelValue:_.value.newPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>_.value.newPassword=t),type:"password",placeholder:"请输入新密码（建议：merchant123）","show-password":""},null,8,["modelValue"]),e[21]||(e[21]=d("div",{style:{color:"#909399","font-size":"12px","margin-top":"5px"}}," 密码要求：6-20位，包含字母和数字 ",-1))]),_:1}),l(H,{title:"重置后请及时通知商户新密码，建议商户登录后立即修改",type:"warning",closable:!1,"show-icon":""})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(P,{modelValue:I.value,"onUpdate:modelValue":e[7]||(e[7]=t=>I.value=t),title:"商户详情",width:"600px"},{default:a(()=>[s.value?(n(),u(K,{key:0,column:2,border:""},{default:a(()=>[l(f,{label:"商户ID"},{default:a(()=>[r(i(s.value.id),1)]),_:1}),l(f,{label:"用户名"},{default:a(()=>[r(i(s.value.username),1)]),_:1}),l(f,{label:"真实姓名"},{default:a(()=>[r(i(s.value.realName),1)]),_:1}),l(f,{label:"手机号"},{default:a(()=>[r(i(s.value.phone),1)]),_:1}),l(f,{label:"申请时间",span:2},{default:a(()=>[r(i(h(s.value.applyTime)),1)]),_:1}),l(f,{label:"审核状态"},{default:a(()=>[s.value.auditStatus===0?(n(),u(k,{key:0,type:"warning",size:"large",effect:"plain"},{default:a(()=>[...e[24]||(e[24]=[r("待审核",-1)])]),_:1})):s.value.auditStatus===1?(n(),u(k,{key:1,type:"success",size:"large",effect:"plain"},{default:a(()=>[...e[25]||(e[25]=[r("已通过",-1)])]),_:1})):s.value.auditStatus===2?(n(),u(k,{key:2,type:"danger",size:"large",effect:"plain"},{default:a(()=>[...e[26]||(e[26]=[r("已拒绝",-1)])]),_:1})):c("",!0)]),_:1}),l(f,{label:"审核时间"},{default:a(()=>[r(i(s.value.auditTime?h(s.value.auditTime):"-"),1)]),_:1}),l(f,{label:"审核备注",span:2},{default:a(()=>[r(i(s.value.auditRemarks||"-"),1)]),_:1}),l(f,{label:"身份证正面",span:2},{default:a(()=>[s.value.idCardFront?(n(),u(S,{key:0,src:s.value.idCardFront,"preview-src-list":[s.value.idCardFront],style:{width:"200px",cursor:"pointer"},fit:"contain"},null,8,["src","preview-src-list"])):c("",!0)]),_:1}),l(f,{label:"身份证反面",span:2},{default:a(()=>[s.value.idCardBack?(n(),u(S,{key:0,src:s.value.idCardBack,"preview-src-list":[s.value.idCardBack],style:{width:"200px",cursor:"pointer"},fit:"contain"},null,8,["src","preview-src-list"])):c("",!0)]),_:1})]),_:1})):c("",!0)]),_:1},8,["modelValue"])])}}},Ye=ve(ke,[["__scopeId","data-v-d9061a42"]]);export{Ye as default};
