/* empty css                  *//* empty css                   *//* empty css                *//* empty css                     *//* empty css                    *//* empty css                    *//* empty css                 *//* empty css                        *//* empty css               *//* empty css               *//* empty css                  *//* empty css                     */import{aE as Y,aB as Z,r as b,c as $,l as H,j as ee,z as B,R as l,J as a,K as le,A as x,I as F,B as _,Q as ae,a6 as te,O as n,u as q,P as D}from"./vendor-DSBWSuTS.js";import{k as oe,Y as se,Z as re,d as ie,e as ue,L as ne,K as de,j as me,a8 as pe,au as fe,f as ce,m as ge,n as be,p as _e,ak as ye,X as ve,a0 as we,E as m}from"./elementPlus-fsp5CJhs.js";import{g as Ve,b as xe,u as Ie,c as Te,e as Ee}from"./room-Cn3l7vr2.js";import{_ as Pe}from"./index-rlk3mQiZ.js";const Ne={class:"room-form"},Re={class:"card-header"},ke={style:{display:"flex",gap:"8px","align-items":"center"}},Ue={__name:"Form",setup(Ce){const V=Y(),I=Z(),T=b(),E=b(!1),P=b(!1),N=b(!1),R=b([]),y=b([]),g=$(()=>!!V.params.id),t=H({roomNumber:"",roomTypeId:null,floorNumber:1,area:null,bedType:"",maxGuests:2,basePrice:null,currentPrice:null,status:1,facilities:[],description:"",wifiPassword:"",images:[]}),O={roomNumber:[{required:!0,message:"请输入房间号",trigger:"blur"},{min:1,max:20,message:"房间号长度在1到20个字符",trigger:"blur"}],roomTypeId:[{required:!0,message:"请选择房型",trigger:"change"}],floorNumber:[{required:!0,message:"请输入楼层",trigger:"blur"}],area:[{required:!0,message:"请输入面积",trigger:"blur"}],bedType:[{required:!0,message:"请选择床型",trigger:"change"}],maxGuests:[{required:!0,message:"请输入最大入住人数",trigger:"blur"}],basePrice:[{required:!0,message:"请输入基础价格",trigger:"blur"}],currentPrice:[{required:!0,message:"请输入当前价格",trigger:"blur"}],status:[{required:!0,message:"请选择房间状态",trigger:"change"}]},U=async()=>{try{const s=await Ve();R.value=s.data}catch(s){console.error("获取房型列表失败:",s),m.error("获取房型列表失败")}},S=s=>{const e=R.value.find(o=>o.id===s);e&&(t.basePrice=e.basePrice,t.currentPrice=e.basePrice)},L=async()=>{try{N.value=!0;const e=await(await fetch("/api/v1/dev/init-room-types",{method:"POST",headers:{"Content-Type":"application/json"}})).json();e.code===200?(m.success(e.message||"房型数据初始化成功"),await U()):m.error(e.message||"房型数据初始化失败")}catch(s){console.error("初始化房型数据失败:",s),m.error("初始化房型数据失败")}finally{N.value=!1}},j=async s=>{var e,o;console.log("开始自定义上传，文件:",s.file.name);try{const i=new FormData;i.append("file",s.file);const c=g.value?V.params.id:Date.now();console.log("上传参数 - 房间ID:",c,"文件大小:",s.file.size);const u=await Ie(i,c),d=u.data;console.log("上传成功，图片URL:",d),t.images.push(d),s.onSuccess(u,s.file),m.success("图片上传成功")}catch(i){console.error("图片上传失败:",i),m.error("图片上传失败: "+(((o=(e=i.response)==null?void 0:e.data)==null?void 0:o.message)||i.message)),s.onError(i,s.file)}},G=s=>{const e=t.images.findIndex(i=>i===s.url);e>-1&&t.images.splice(e,1);const o=y.value.findIndex(i=>i.url===s.url);o>-1&&y.value.splice(o,1)},J=s=>{const e=s.type.startsWith("image/"),o=s.size/1024/1024<10;return e?o?!0:(m.error("图片大小不能超过 10MB!"),!1):(m.error("只能上传图片文件!"),!1)},M=async()=>{var s,e;try{await T.value.validate(),P.value=!0;const o={...t,facilities:JSON.stringify(t.facilities),images:JSON.stringify(t.images)};g.value?(await Te(V.params.id,o),m.success("房间更新成功"),setTimeout(()=>{I.push("/admin/rooms")},1500)):(await Ee(o),m.success("房间创建成功"),setTimeout(()=>{I.push("/admin/rooms")},1500))}catch(o){console.error("操作失败:",o),(e=(s=o.response)==null?void 0:s.data)!=null&&e.message?m.error(o.response.data.message):m.error(g.value?"房间更新失败":"房间创建失败")}finally{P.value=!1}},W=()=>{T.value.resetFields(),y.value=[],t.images=[],t.facilities=[]},C=()=>{I.push("/admin/rooms")},z=async s=>{if(s){E.value=!0;try{const o=(await xe(s)).data;if(o.facilities)try{o.facilities=JSON.parse(o.facilities)}catch{o.facilities=[]}if(o.images)try{o.images=JSON.parse(o.images),y.value=o.images.map((i,c)=>({name:`image-${c}`,url:i}))}catch{o.images=[]}Object.assign(t,o),console.log("房间数据加载成功:",o)}catch(e){console.error("获取房间信息失败:",e),m.error("获取房间信息失败")}finally{E.value=!1}}};return ee(()=>{U(),g.value&&z(V.params.id)}),(s,e)=>{const o=be,i=me,c=ue,u=ie,d=re,p=de,k=ne,v=se,w=pe,f=ce,K=fe,h=ge,A=oe,Q=we,X=ye;return x(),B("div",Ne,[l(Q,{shadow:"never"},{header:a(()=>[_("div",Re,[_("h3",null,D(g.value?"编辑房间":"添加房间"),1),l(i,{onClick:C},{default:a(()=>[l(o,null,{default:a(()=>[l(q(ve))]),_:1}),e[12]||(e[12]=n(" 返回 ",-1))]),_:1})])]),default:a(()=>[le((x(),F(A,{ref_key:"formRef",ref:T,model:t,rules:O,"label-width":"120px"},{default:a(()=>[l(v,{gutter:20},{default:a(()=>[l(d,{span:8},{default:a(()=>[l(u,{label:"房间号",prop:"roomNumber"},{default:a(()=>[l(c,{modelValue:t.roomNumber,"onUpdate:modelValue":e[0]||(e[0]=r=>t.roomNumber=r),placeholder:"请输入房间号",disabled:g.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),l(d,{span:16},{default:a(()=>[l(u,{label:"房型",prop:"roomTypeId"},{default:a(()=>[_("div",ke,[l(k,{modelValue:t.roomTypeId,"onUpdate:modelValue":e[1]||(e[1]=r=>t.roomTypeId=r),placeholder:"请选择房型",style:{"min-width":"200px",flex:"1"},onChange:S,"popper-class":"room-type-dropdown",teleported:!1,placement:"bottom-start",clearable:""},{default:a(()=>[(x(!0),B(ae,null,te(R.value,r=>(x(),F(p,{key:r.id,label:r.typeName,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(i,{type:"warning",size:"small",onClick:L,loading:N.value},{default:a(()=>[...e[13]||(e[13]=[n(" 初始化房型 ",-1)])]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1}),l(v,{gutter:20},{default:a(()=>[l(d,{span:12},{default:a(()=>[l(u,{label:"楼层",prop:"floorNumber"},{default:a(()=>[l(w,{modelValue:t.floorNumber,"onUpdate:modelValue":e[2]||(e[2]=r=>t.floorNumber=r),min:1,max:50,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:12},{default:a(()=>[l(u,{label:"面积(㎡)",prop:"area"},{default:a(()=>[l(w,{modelValue:t.area,"onUpdate:modelValue":e[3]||(e[3]=r=>t.area=r),min:10,max:200,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(v,{gutter:20},{default:a(()=>[l(d,{span:8},{default:a(()=>[l(u,{label:"床型",prop:"bedType"},{default:a(()=>[l(k,{modelValue:t.bedType,"onUpdate:modelValue":e[4]||(e[4]=r=>t.bedType=r),placeholder:"请选择床型",style:{width:"100%","min-width":"120px"},"popper-class":"bed-type-dropdown",teleported:!1,placement:"bottom-start",clearable:""},{default:a(()=>[l(p,{label:"单人床",value:"单人床"}),l(p,{label:"双人床",value:"双人床"}),l(p,{label:"大床",value:"大床"}),l(p,{label:"双床",value:"双床"}),l(p,{label:"上下铺",value:"上下铺"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:a(()=>[l(u,{label:"最大入住人数",prop:"maxGuests"},{default:a(()=>[l(w,{modelValue:t.maxGuests,"onUpdate:modelValue":e[5]||(e[5]=r=>t.maxGuests=r),min:1,max:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:a(()=>[l(u,{label:"房间状态",prop:"status"},{default:a(()=>[l(k,{modelValue:t.status,"onUpdate:modelValue":e[6]||(e[6]=r=>t.status=r),placeholder:"请选择房间状态",style:{width:"100%","min-width":"120px"},"popper-class":"room-status-dropdown",teleported:!1,placement:"bottom-start",clearable:""},{default:a(()=>[l(p,{label:"可用",value:1}),l(p,{label:"占用",value:2}),l(p,{label:"维修",value:3}),l(p,{label:"清洁",value:4}),l(p,{label:"停用",value:5})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(v,{gutter:20},{default:a(()=>[l(d,{span:12},{default:a(()=>[l(u,{label:"基础价格",prop:"basePrice"},{default:a(()=>[l(w,{modelValue:t.basePrice,"onUpdate:modelValue":e[7]||(e[7]=r=>t.basePrice=r),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"]),e[14]||(e[14]=_("span",{style:{"margin-left":"8px"}},"元/晚",-1))]),_:1})]),_:1}),l(d,{span:12},{default:a(()=>[l(u,{label:"当前价格",prop:"currentPrice"},{default:a(()=>[l(w,{modelValue:t.currentPrice,"onUpdate:modelValue":e[8]||(e[8]=r=>t.currentPrice=r),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"]),e[15]||(e[15]=_("span",{style:{"margin-left":"8px"}},"元/晚",-1))]),_:1})]),_:1})]),_:1}),l(v,{gutter:20},{default:a(()=>[l(d,{span:24},{default:a(()=>[l(u,{label:"WiFi密码",prop:"wifiPassword"},{default:a(()=>[l(c,{modelValue:t.wifiPassword,"onUpdate:modelValue":e[9]||(e[9]=r=>t.wifiPassword=r),placeholder:"请输入WiFi密码","show-password":"",style:{"max-width":"400px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(u,{label:"房间设施",prop:"facilities"},{default:a(()=>[l(K,{modelValue:t.facilities,"onUpdate:modelValue":e[10]||(e[10]=r=>t.facilities=r)},{default:a(()=>[l(f,{label:"空调"},{default:a(()=>[...e[16]||(e[16]=[n("空调",-1)])]),_:1}),l(f,{label:"电视"},{default:a(()=>[...e[17]||(e[17]=[n("电视",-1)])]),_:1}),l(f,{label:"冰箱"},{default:a(()=>[...e[18]||(e[18]=[n("冰箱",-1)])]),_:1}),l(f,{label:"热水器"},{default:a(()=>[...e[19]||(e[19]=[n("热水器",-1)])]),_:1}),l(f,{label:"洗衣机"},{default:a(()=>[...e[20]||(e[20]=[n("洗衣机",-1)])]),_:1}),l(f,{label:"微波炉"},{default:a(()=>[...e[21]||(e[21]=[n("微波炉",-1)])]),_:1}),l(f,{label:"吹风机"},{default:a(()=>[...e[22]||(e[22]=[n("吹风机",-1)])]),_:1}),l(f,{label:"WiFi"},{default:a(()=>[...e[23]||(e[23]=[n("WiFi",-1)])]),_:1}),l(f,{label:"阳台"},{default:a(()=>[...e[24]||(e[24]=[n("阳台",-1)])]),_:1}),l(f,{label:"独立卫浴"},{default:a(()=>[...e[25]||(e[25]=[n("独立卫浴",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"房间描述",prop:"description"},{default:a(()=>[l(c,{modelValue:t.description,"onUpdate:modelValue":e[11]||(e[11]=r=>t.description=r),type:"textarea",rows:4,placeholder:"请输入房间描述"},null,8,["modelValue"])]),_:1}),l(u,{label:"房间图片",prop:"images"},{default:a(()=>[l(h,{class:"room-images-upload","auto-upload":!0,"http-request":j,"list-type":"picture-card","file-list":y.value,"on-remove":G,"before-upload":J,multiple:"",limit:6},{tip:a(()=>[...e[26]||(e[26]=[_("div",{class:"el-upload__tip"}," 只能上传图片文件，且不超过10MB，最多6张图片 ",-1)])]),default:a(()=>[l(o,null,{default:a(()=>[l(q(_e))]),_:1})]),_:1},8,["file-list"])]),_:1}),l(u,null,{default:a(()=>[l(i,{type:"primary",onClick:M,loading:P.value},{default:a(()=>[n(D(g.value?"更新":"保存"),1)]),_:1},8,["loading"]),l(i,{onClick:W},{default:a(()=>[...e[27]||(e[27]=[n("重置",-1)])]),_:1}),l(i,{onClick:C},{default:a(()=>[...e[28]||(e[28]=[n("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])),[[X,E.value]])]),_:1})])}}},Qe=Pe(Ue,[["__scopeId","data-v-1d8aba94"]]);export{Qe as default};
