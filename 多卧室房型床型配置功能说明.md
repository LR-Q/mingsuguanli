# 多卧室房型床型配置功能说明

## 问题描述
当管理员编辑"两房一厅"、"三房一厅"等多卧室房型时，原系统只能设置一个整体的"床型"，无法分别配置每个卧室的具体床型（如主卧是大床，次卧是双床），导致顾客无法了解各个房间的床型配置。

## 解决方案

### 数据库层面
添加了`bedroom_config`字段到`room_info`表，用于存储多个卧室的详细配置信息。

**字段结构**：
```sql
bedroom_config JSON COMMENT '卧室配置(JSON格式，存储多个卧室的床型信息)'
```

**数据格式示例**：
```json
{
  "bedrooms": [
    {
      "name": "主卧",
      "bedType": "大床",
      "bedCount": 1
    },
    {
      "name": "次卧",
      "bedType": "双床",
      "bedCount": 2
    }
  ]
}
```

### 后端层面
在`RoomInfo`实体类中添加了`bedroomConfig`字段：
```java
/**
 * 卧室配置（多卧室房型的详细配置，JSON格式）
 */
@TableField("bedroom_config")
private String bedroomConfig;
```

### 前端层面

#### 1. 智能识别房型
系统会自动识别房型类型：
- **单卧室房型**：如"一房"、"单房"、"标准间"等 → 显示简单的床型选择
- **多卧室房型**：如"两房一厅"、"三房一厅"等 → 显示详细的卧室配置界面

#### 2. 自动初始化卧室配置
当选择房型时，系统会自动初始化卧室配置：
- **两房一厅** → 主卧（大床） + 次卧（双床）
- **三房一厅** → 主卧（大床） + 次卧1（双床） + 次卧2（单人床）
- **四房一厅** → 主卧（大床） + 次卧1（双床） + 次卧2（单人床） + 次卧3（单人床）

#### 3. 卧室配置界面
对于多卧室房型，管理员可以：
- **查看所有卧室**：每个卧室一行，显示房间名称、床型、床数量
- **修改配置**：
  - 修改房间名称（如"主卧"、"次卧"、"儿童房"等）
  - 选择床型（单人床、双人床、大床、双床、上下铺）
  - 设置床数量（1-4张）
- **添加卧室**：点击"添加卧室"按钮，可以添加更多房间
- **删除卧室**：点击删除按钮（至少保留1个卧室）

## 使用步骤

### 1. 执行数据库脚本
```bash
# 在数据库中执行
mysql -u root -p yxly_db < 添加房间卧室配置字段.sql
```

### 2. 重启后端服务
```bash
cd e:\CursorProject\LRminsu\yxly-backend
mvn spring-boot:run
```

### 3. 重启前端服务
```bash
cd e:\CursorProject\LRminsu\yxly-admin-frontend
npm run dev
```

### 4. 编辑房间
1. 登录管理员后台
2. 进入"房间管理"
3. 点击"编辑"某个两房一厅的房间
4. 现在可以看到"卧室配置"区域
5. 分别设置每个卧室的床型
6. 保存

## 界面示例

### 单卧室房型（如标准间）
```
床型: [大床 ▼]
```

### 多卧室房型（如两房一厅）
```
卧室配置 *

┌─────────────────────────────────────────────┐
│ 主卧        [大床 ▼]     [1] 张              │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│ 次卧        [双床 ▼]     [2] 张       [删除]  │
└─────────────────────────────────────────────┘

[+ 添加卧室]
```

## 用户端显示

顾客在用户端查看房间详情时，会看到：

**两房一厅 - 房间120**
- 主卧：大床 x 1
- 次卧：双床 x 2
- 可住4人

## 优势

### 对管理员
- ✅ 详细管理每个卧室的床型配置
- ✅ 自动初始化，减少录入工作
- ✅ 灵活添加/删除卧室
- ✅ 直观的配置界面

### 对顾客
- ✅ 清楚了解各个房间的床型
- ✅ 更准确地评估是否适合家庭入住
- ✅ 提升预订决策效率
- ✅ 减少入住后的误解和投诉

## 兼容性

### 向后兼容
- ✅ 已有的房间数据不受影响
- ✅ `bed_type`字段保留，用于单卧室房型
- ✅ 系统会自动迁移现有数据到新格式

### 数据迁移
执行数据库脚本时，会自动将现有的`bed_type`转换为`bedroom_config`格式：
```sql
UPDATE room_info 
SET bedroom_config = JSON_OBJECT(
    'bedrooms', JSON_ARRAY(
        JSON_OBJECT(
            'name', '卧室',
            'bedType', COALESCE(bed_type, '大床'),
            'bedCount', 1
        )
    )
)
WHERE bedroom_config IS NULL;
```

## 扩展性

未来可以进一步扩展：
- 每个卧室添加面积信息
- 每个卧室添加设施信息（如独立卫浴）
- 每个卧室添加照片
- 支持更多床型选项
- 支持组合床型（如1个大床+1个小床）

## 技术细节

### 前端判断逻辑
```javascript
const isMultiBedroomType = computed(() => {
  if (!formData.roomTypeId) return false
  const selectedType = roomTypes.value.find(t => t.id === formData.roomTypeId)
  if (!selectedType) return false
  const typeName = selectedType.typeName || ''
  // 判断是否包含"房"字且不是单房
  return typeName.includes('房') && !typeName.includes('一房') && !typeName.includes('单房')
})
```

### 数据提交逻辑
```javascript
// 多卧室房型
if (isMultiBedroomType.value) {
  submitData.bedroomConfig = JSON.stringify({
    bedrooms: bedrooms.value
  })
  submitData.bedType = null
} else {
  // 单卧室房型
  submitData.bedroomConfig = null
}
```

## 常见问题

### Q1：为什么我的两房一厅还是只显示单个床型选择？
**A**: 请确保：
1. 数据库字段已添加
2. 后端服务已重启
3. 前端缓存已清除（Ctrl+F5强制刷新）

### Q2：如何修改已有房间的床型配置？
**A**: 
1. 进入房间编辑页面
2. 如果是多卧室房型，会自动显示卧室配置区域
3. 直接修改各个卧室的配置
4. 保存即可

### Q3：可以自定义卧室名称吗？
**A**: 可以！卧室名称是可编辑的文本框，您可以输入：
- 主卧、次卧
- 儿童房、客房
- 一号房、二号房
- 或任何您喜欢的名称

### Q4：床数量有限制吗？
**A**: 每个卧室的床数量限制为1-4张，如果需要更多，可以添加多个卧室。

## 总结

这个功能完美解决了多卧室房型床型配置不清晰的问题，让管理员能够详细记录每个卧室的床型信息，顾客也能清楚地了解房间的实际配置，提升了系统的实用性和用户体验。
