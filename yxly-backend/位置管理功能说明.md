# 位置管理功能说明文档

## 功能概述
位置管理功能允许管理员在后台设置民宿的地理位置信息，用户可以在前端查看位置并进行导航。

## 数据库表结构

### location_info（位置信息表）
```sql
CREATE TABLE IF NOT EXISTS `location_info` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '位置ID',
  `name` VARCHAR(100) NOT NULL COMMENT '位置名称',
  `address` VARCHAR(255) NOT NULL COMMENT '详细地址',
  `province` VARCHAR(50) DEFAULT NULL COMMENT '省份',
  `city` VARCHAR(50) DEFAULT NULL COMMENT '城市',
  `district` VARCHAR(50) DEFAULT NULL COMMENT '区县',
  `longitude` DECIMAL(10, 7) NOT NULL COMMENT '经度',
  `latitude` DECIMAL(10, 7) NOT NULL COMMENT '纬度',
  `contact_phone` VARCHAR(20) DEFAULT NULL COMMENT '联系电话',
  `description` TEXT COMMENT '位置描述',
  `map_type` VARCHAR(20) DEFAULT 'baidu' COMMENT '地图类型(baidu/amap/google)',
  `is_active` TINYINT(1) DEFAULT 1 COMMENT '是否启用(0:禁用 1:启用)',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标记(0:未删除 1:已删除)',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='位置信息表';
```

## API接口说明

### 管理员端接口 (需要管理员权限)

#### 1. 分页查询位置列表
- **接口路径**: `GET /v1/admin/locations`
- **请求参数**:
  - `current`: 当前页，默认1
  - `size`: 每页大小，默认10
- **返回数据**: 位置信息分页列表

#### 2. 查询位置详情
- **接口路径**: `GET /v1/admin/locations/{id}`
- **路径参数**:
  - `id`: 位置ID
- **返回数据**: 位置详细信息

#### 3. 创建位置
- **接口路径**: `POST /v1/admin/locations`
- **请求体**:
```json
{
  "name": "悦鑫乐怡民宿",
  "address": "北京市朝阳区XX街道XX号",
  "province": "北京市",
  "city": "北京市",
  "district": "朝阳区",
  "longitude": 116.4073963,
  "latitude": 39.9041999,
  "contactPhone": "13800138000",
  "description": "位于市中心，交通便利",
  "mapType": "baidu",
  "isActive": 1
}
```
- **返回数据**: 创建的位置ID

#### 4. 更新位置
- **接口路径**: `PUT /v1/admin/locations/{id}`
- **路径参数**:
  - `id`: 位置ID
- **请求体**: 同创建位置
- **返回数据**: 更新成功消息

#### 5. 删除位置
- **接口路径**: `DELETE /v1/admin/locations/{id}`
- **路径参数**:
  - `id`: 位置ID
- **返回数据**: 删除成功消息

#### 6. 启用/禁用位置
- **接口路径**: `PATCH /v1/admin/locations/{id}/status`
- **路径参数**:
  - `id`: 位置ID
- **请求参数**:
  - `isActive`: 是否启用 (0:禁用, 1:启用)
- **返回数据**: 状态更新成功消息

### 用户端接口 (无需权限)

#### 1. 获取民宿位置
- **接口路径**: `GET /v1/location`
- **返回数据**: 当前启用的民宿位置信息
- **说明**: 用于用户端首页展示位置和导航

## 使用步骤

### 1. 初始化数据库
在数据库中执行SQL文件：
```bash
yxly-backend/src/main/resources/sql/location_info.sql
```

### 2. 管理员设置位置
1. 登录管理员后台
2. 进入"位置管理"页面
3. 点击"新建位置"或"编辑"按钮
4. 在地图上选择民宿位置（或手动输入经纬度）
5. 填写详细地址和描述信息
6. 保存位置信息
7. 确保位置状态为"启用"

### 3. 前端地图集成建议

#### 百度地图示例
```javascript
// 管理员端 - 选择位置
const map = new BMap.Map("mapContainer");
const point = new BMap.Point(116.4073963, 39.9041999);
map.centerAndZoom(point, 15);

// 添加点击事件获取经纬度
map.addEventListener("click", function(e) {
  const lng = e.point.lng;
  const lat = e.point.lat;
  console.log("选择的位置：", lng, lat);
});

// 用户端 - 显示位置和导航
const marker = new BMap.Marker(point);
map.addOverlay(marker);

// 导航按钮
function navigate() {
  window.open(`https://api.map.baidu.com/marker?location=${lat},${lng}&title=悦鑫乐怡民宿&content=点击查看路线&output=html`);
}
```

#### 高德地图示例
```javascript
// 管理员端 - 选择位置
const map = new AMap.Map('mapContainer', {
  center: [116.4073963, 39.9041999],
  zoom: 15
});

map.on('click', function(e) {
  const lng = e.lnglat.getLng();
  const lat = e.lnglat.getLat();
  console.log("选择的位置：", lng, lat);
});

// 用户端 - 显示位置和导航
const marker = new AMap.Marker({
  position: [116.4073963, 39.9041999],
  title: '悦鑫乐怡民宿'
});
map.add(marker);

// 导航按钮
function navigate() {
  window.open(`https://uri.amap.com/marker?position=${lng},${lat}&name=悦鑫乐怡民宿`);
}
```

## 前端实现建议

### 管理员端
1. **位置管理列表页**
   - 展示所有位置信息
   - 支持新增、编辑、删除、启用/禁用操作
   
2. **位置编辑页**
   - 集成地图组件（百度地图/高德地图）
   - 支持地图选点或地址搜索
   - 自动获取经纬度
   - 表单填写详细信息

### 用户端
1. **首页位置展示**
   - 显示民宿位置地图
   - 展示地址和联系电话
   - 提供"导航到这里"按钮
   
2. **详情页**
   - 完整的地图展示
   - 周边设施介绍
   - 交通路线说明

## 注意事项

1. **地图API密钥**: 需要在对应地图平台申请API密钥
2. **经纬度精度**: 数据库中经纬度字段使用 DECIMAL(10, 7) 类型，保证精度
3. **多位置管理**: 系统支持多个位置，但用户端只显示启用的位置（is_active=1）
4. **坐标系说明**:
   - 百度地图使用BD09坐标系
   - 高德地图使用GCJ02坐标系
   - GPS使用WGS84坐标系
   - 需要根据使用的地图进行坐标转换

## 测试建议

### 后端测试
1. 使用Swagger UI测试所有接口
2. 测试创建、查询、更新、删除操作
3. 测试启用/禁用功能
4. 测试用户端查询接口

### 前端测试
1. 测试地图组件加载
2. 测试位置选择功能
3. 测试导航功能
4. 测试在不同设备上的显示效果

## 扩展功能建议

1. **周边设施**: 添加周边餐饮、景点、交通站点等信息
2. **路线规划**: 集成路线规划功能
3. **街景展示**: 集成街景视图
4. **多语言支持**: 支持中英文地址
5. **位置历史**: 记录位置变更历史

## 技术支持
如有问题，请查看项目文档或联系开发团队。
