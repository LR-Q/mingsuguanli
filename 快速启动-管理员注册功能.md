# 🚀 民宿主管理员注册功能 - 快速启动

## 一、执行数据库脚本（必须）

### 方法1：直接执行SQL文件
```bash
# 在项目根目录找到并执行
mysql -u root -p yxly_dev < create_merchant_tables.sql
```

### 方法2：手动复制执行
1. 打开 `create_merchant_tables.sql` 文件
2. 复制全部内容
3. 在MySQL客户端或Navicat中执行

---

## 二、验证数据库表

执行以下SQL验证：
```sql
-- 检查表是否创建
SHOW TABLES LIKE '%merchant%';

-- 查看角色数据
SELECT * FROM sys_role;

-- 检查sys_user新增字段
DESC sys_user;
```

应该看到：
- ✅ `merchant_info` 表存在
- ✅ `merchant_apply_log` 表存在  
- ✅ `sys_role` 有3条数据（SUPER_ADMIN, HOMESTAY_ADMIN, USER）
- ✅ `sys_user` 有 `merchant_id`, `merchant_status`, `apply_time` 字段
- ✅ `room_info` 和 `booking_order` 有 `merchant_id` 字段

---

## 三、启动后端服务

```bash
cd yxly-backend
mvn spring-boot:run
```

检查控制台，确保没有错误信息。

---

## 四、启动前端服务

```bash
cd yxly-frontend
npm run dev
```

访问 http://localhost:5173

---

## 五、测试注册流程

### 1. 访问注册页面
浏览器打开：http://localhost:5173/register

### 2. 点击"我是民宿主，注册管理员账号"按钮

### 3. 填写注册信息
```
【账号信息】
用户名: merchant001
密码: Test1234
确认密码: Test1234

【个人信息】
真实姓名: 张三
手机号: 13800138001
邮箱: merchant001@example.com

【民宿信息】
民宿名称: 张三的度假民宿
营业执照号: 91110000MA001234（可选）
联系人: 张三
联系电话: 13800138001
联系邮箱: contact@example.com

【地址信息】
省份: 北京市
城市: 北京市
区县: 朝阳区
详细地址: 三里屯SOHO
```

### 4. 提交注册
点击"提交注册申请"按钮，应该提示：
> 注册申请提交成功！请等待平台审核，审核通过后即可登录使用

---

## 六、手动审核通过（临时方案）

在MySQL中执行：
```sql
-- 1. 查找新注册的用户
SELECT id, username, status, merchant_status FROM sys_user WHERE username = 'merchant001';

-- 2. 记下用户ID，然后执行审核通过
SET @user_id = (SELECT id FROM sys_user WHERE username = 'merchant001');

UPDATE sys_user 
SET status = 1, merchant_status = 1 
WHERE id = @user_id;

UPDATE merchant_info 
SET audit_status = 1, audit_time = NOW(), auditor_id = 1
WHERE admin_user_id = @user_id;

-- 3. 验证审核结果
SELECT u.username, u.status, u.merchant_status, m.merchant_name, m.audit_status
FROM sys_user u
LEFT JOIN merchant_info m ON u.merchant_id = m.id
WHERE u.username = 'merchant001';
```

---

## 七、测试登录

1. 访问登录页面：http://localhost:5173/login
2. 切换到"管理员"登录
3. 输入：
   - 用户名: merchant001
   - 密码: Test1234
4. 点击登录

应该能成功登录并进入管理后台！

---

## 🎉 完成！

现在你的系统已经支持：
- ✅ 普通用户注册
- ✅ 民宿主管理员注册
- ✅ 多租户数据隔离
- ✅ 角色权限管理

---

## 📋 后续待办

- [ ] 开发商户审核管理页面
- [ ] 开发资质证明上传功能
- [ ] 实现数据权限自动过滤
- [ ] 优化审核流程

---

## ❓ 遇到问题？

### 问题1：后端启动报错
**检查点**：
- 数据库脚本是否执行成功
- application.yml 数据库配置是否正确
- Maven依赖是否完整

### 问题2：前端页面404
**检查点**：
- 路由配置是否正确
- 组件文件是否存在
- npm依赖是否安装完整

### 问题3：注册失败
**检查点**：
- 后端控制台错误日志
- 浏览器开发者工具Network面板
- 数据库表结构是否正确

### 问题4：登录失败
**检查点**：
- 用户status是否为1（启用）
- merchant_status是否为1（已认证）
- 密码是否正确

---

**祝您使用愉快！** 🎊
